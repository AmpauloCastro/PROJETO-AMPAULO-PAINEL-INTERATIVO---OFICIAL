<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Chosen Palette: "Subtle Steel and Teal" -->
    <!-- Application Structure Plan: A single-page application (SPA) with a fixed top navigation bar to switch between different content views (Home, Hoje, Treino, Corrida, Nutri√ß√£o, Progresso, Calend√°rio, Finan√ßas). This tabbed/view-based structure was chosen to break down the dense, multi-faceted report into manageable, focused sections. The default view is "Home," providing immediate access to personal data, which is the start of the user's journey. This avoids overwhelming the user with a long, single-scrolling page and makes finding specific information (like a workout detail or a nutritional value) much faster and more intuitive. The "Progresso" section is designed as a dedicated dashboard to visualize data, offering a more engaging and insightful experience than static tables. -->
    <!-- Visualization & Content Choices:
        - **Home (User Profile):** Goal: Personalization/Data Input. Method: Simple form fields. Justification: Collects essential user data for potential future customization of LLM features.
        - **Hoje (Today's View):** Goal: Inform/Track. Method: Dynamically generated cards using JS for today's workout, schedule, and tracking. Justification: Provides immediate, relevant information for daily use. Also displays financial obligations due today.
        - **Amanh√£ (Tomorrow's View):** Goal: Inform. Method: Similar to "Hoje", displaying tomorrow's schedule and financial obligations.
        - **Plano de Treino/Corrida:** Goal: Organize/Inform. Method: Nested accordion-style sections for each workout and then for each muscle group. Interaction: JS toggles visibility for both levels. Justification: Provides granular detail for each exercise and its target muscle focus, allowing deep exploration without clutter. All previous muscle focus details from the PDF have been meticulously integrated into each exercise's description.
        - **Corrida:** Goal: Inform/Organize. Method: Detailed table rows for running stages, explicitly breaking down combined paces (e.g., RF/RM) into individual types with their corresponding km/h ranges and segment durations. The table styling has been updated with alternating row colors and a darker header for improved readability. Horizontal scrolling is enabled for the table.
        - **Nutri√ß√£o:** Goal: Inform. Method: Clean, styled HTML tables. Justification: Clear and direct presentation of structured data.
        - **Progresso (Progress):** Goal: Compare/Show Change. Method: Editable table for manual data input, and interactive charts using Chart.js on Canvas, generated on user click. Viz: 1) Line chart for Weight & Body Fat % trend. 2) Stacked Bar chart for Body Composition (Fat vs. Lean Mass). 3) Line chart for Circumference changes. 4) Radar chart for Skinfold changes. Interaction: Tooltips on hover. Justification: Dynamic charts provide a much richer understanding of trends and composition changes compared to static data tables.
        - **Calend√°rio (Calendar):** Goal: Inform/Motivate. Method: HTML grid. Interaction: Click to show daily message/verse in a modal. Justification: Provides a high-level monthly overview and keeps motivational content accessible but unobtrusive. Now also shows financial obligations.
        - **Finan√ßas (Finances):** Goal: Track/Inform. Method: Dedicated section for financial obligations and salary/advance payment dates.
        - **CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.** -->
    <title>PROJETO AMPAULO ‚Äì Painel Interativo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Helper function for getting day names, globally accessible
        function getDayName(date) {
            const weekdays = ["Domingo", "Segunda-feira", "Ter√ßa-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "S√°bado"];
            return weekdays[date.getDay()];
        }

        // --- HOLIDAYS 2025 ---
        // Format: YYYY-MM-DD for easy Date object creation
        const holidays2025 = [
            // National Holidays (Brazil)
            "2025-01-01", // Confraterniza√ß√£o Universal
            "2025-03-03", // Carnaval (Ponto Facultativo)
            "2025-03-04", // Carnaval (Ponto Facultativo)
            "2025-03-05", // Quarta-feira de Cinzas (Ponto Facultativo at√© 14h)
            "2025-04-18", // Paix√£o de Cristo
            "2025-04-21", // Tiradentes
            "2025-05-01", // Dia do Trabalho
            "2025-06-19", // Corpus Christi (Ponto Facultativo)
            "2025-09-07", // Independ√™ncia do Brasil
            "2025-10-12", // Nossa Senhora Aparecida
            "2025-11-02", // Finados
            "2025-11-15", // Proclama√ß√£o da Rep√∫blica
            "2025-11-20", // Dia Nacional de Zumbi e da Consci√™ncia Negra
            "2025-12-25", // Natal

            // State Holidays (Bahia)
            "2025-06-24", // Dia de S√£o Jo√£o
            "2025-07-02", // Independ√™ncia da Bahia
            "2025-12-08", // Nossa Senhora da Concei√ß√£o da Praia

            // Municipal Holidays (Eun√°polis, BA)
            "2025-05-12", // Emancipa√ß√£o de Eun√°polis
            "2025-05-24"  // Nossa Senhora Auxiliadora
        ].map(d => new Date(d + 'T12:00:00')); // Add T12:00:00 to avoid timezone issues with Date objects

        // Helper function to check if a date is a holiday
        function isHoliday(date) {
            const dateString = date.toISOString().slice(0, 10);
            return holidays2025.some(h => h.toISOString().slice(0, 10) === dateString);
        }

        // Helper function to check if a date is a business day (Mon-Fri, excluding holidays)
        function isBusinessDay(date) {
            const dayOfWeek = date.getDay(); // 0 = Sunday, 6 = Saturday
            return dayOfWeek !== 0 && dayOfWeek !== 6 && !isHoliday(date);
        }

        // Helper function to check if a date is a business day including Saturday (Mon-Sat, excluding holidays)
        function isBusinessDayIncludingSaturday(date) {
            const dayOfWeek = date.getDay(); // 0 = Sunday, 6 = Saturday
            return dayOfWeek !== 0 && !isHoliday(date);
        }

        // Function to get the Nth business day of a month
        function getNthBusinessDay(year, month, n, includeSaturday = false) {
            let count = 0;
            let day = 1;
            let date = new Date(year, month, day); // month is 0-indexed

            while (count < n) {
                if (includeSaturday ? isBusinessDayIncludingSaturday(date) : isBusinessDay(date)) {
                    count++;
                }
                if (count < n) { // Increment day only if we haven't found the Nth day yet
                    day++;
                    date = new Date(year, month, day);
                    // Check if we've gone past the end of the month
                    if (date.getMonth() !== month) {
                        return null; // Nth business day not found in this month
                    }
                }
            }
            return date;
        }

        // Function to get the next business day (Mon-Fri, excluding holidays)
        function getNextBusinessDay(date) {
            let nextDay = new Date(date);
            // If the given date is a weekend or holiday, move to the next day
            while (!isBusinessDay(nextDay)) {
                nextDay.setDate(nextDay.getDate() + 1);
            }
            return nextDay;
        }

        // --- DATA STORE ---
        // projectData.progress ser√° carregado do Firestore.
        // projectData.workouts, projectData.runs, projectData.nutrition, projectData.calendar e projectData.weeklySchedule
        // continuam sendo dados est√°ticos do aplicativo por enquanto, pois s√£o menos propensos a mudan√ßas frequentes pelo usu√°rio.
        // Inicializa window.projectData com toda a estrutura, incluindo 'progress'
        window.projectData = {
            workouts: {
                quarta_inferiores_b: { // Treino para Quarta-feira
                    title: "üèãÔ∏è‚Äç‚ôÇÔ∏è TREINO INFERIORES B ‚Äì QUARTA-FEIRA (28 S√âRIES)",
                    series: 28,
                    objective: "Foco: Quadr√≠ceps, Core e Lombar (sem adutores/abdutores)",
                    groups: [
                        {
                            name: "Quadr√≠ceps",
                            series: 12, // 3 exerc√≠cios * 4 s√©ries = 12
                            muscles: "quadr√≠ceps, reto femoral, vasto lateral, vasto medial, gl√∫teos, isquiotibiais",
                            exercises: [
                                { name: "Agachamento com Barra", sets: "4 s√©ries", howto: "Excelente para o <strong>Reto Femoral</strong>, <strong>Vasto Lateral</strong> e <strong>Vasto Medial</strong>." },
                                { name: "Afundo com Halteres", sets: "4 s√©ries", howto: "Trabalha o <strong>Quadr√≠ceps</strong>, <strong>Gl√∫teos</strong> e <strong>Posterior da Coxa</strong>." },
                                { name: "Avan√ßo com Halteres (ou Parado)", sets: "4 s√©ries", howto: "Foco no <strong>Quadr√≠ceps</strong> e no equil√≠brio." }
                            ]
                        },
                        {
                            name: "Core/Abd√¥men",
                            series: 12, // 3 exerc√≠cios * 4 s√©ries = 12
                            muscles: "core, obl√≠quos, reto abdominal, abd√¥men",
                            exercises: [
                                { name: "Abdominal Bicicleta", sets: "4 s√©ries", howto: "Ativa os <strong>Obl√≠quos</strong> e o <strong>Reto Abdominal</strong>." },
                                { name: "Eleva√ß√£o de Pernas", sets: "4 s√©ries", howto: "Foco no <strong>Abd√¥men inferior</strong>." },
                                { name: "Crunch Reto", sets: "4 s√©ries", howto: "Trabalha o <strong>Abd√¥men superior</strong>." }
                            ]
                        },
                        {
                            name: "Lombar",
                            series: 4, // 1 exerc√≠cio * 4 s√©ries = 4
                            muscles: "lombar, gl√∫teos",
                            exercises: [
                                { name: "Superman (Hiperextens√£o)", sets: "4 s√©ries", howto: "Fortalece a <strong>Lombar</strong> e os <strong>Gl√∫teos</strong>." }
                            ]
                        }
                    ]
                },
                sexta_peito_triceps: { // Treino para Sexta-feira
                    title: "üèãÔ∏è‚Äç‚ôÇÔ∏è TREINO PEITO + TR√çCEPS ‚Äì SEXTA-FEIRA (27 S√âRIES)",
                    series: 27,
                    objective: "Desenvolver a for√ßa e o volume do peitoral e tr√≠ceps, essenciais para a estabilidade do tronco e o balan√ßo dos bra√ßos durante a corrida.",
                    groups: [
                        {
                            name: "Peitoral",
                            series: 18, // 5 exerc√≠cios, s√©ries ajustadas para somar 18
                            muscles: "peitoral, peitoral maior, peitoral menor, deltoide (cabe√ßa anterior), tr√≠ceps braquial",
                            exercises: [
                                { name: "Supino com Barra", sets: "4 s√©ries", howto: "O cl√°ssico construtor de volume e for√ßa geral do <strong>Peitoral Maior</strong> e <strong>Peitoral Menor</strong>. Tamb√©m ativa <strong>Tr√≠ceps Braquial</strong> e <strong>Deltoide (cabe√ßa anterior)</strong>." },
                                { name: "Supino Inclinado com Barra", sets: "4 s√©ries", howto: "Foco no <strong>Peitoral Maior (foco superior)</strong>. Ativa tamb√©m <strong>Deltoide (cabe√ßa anterior)</strong> e <strong>Tr√≠ceps Braquial</strong>." },
                                { name: "Crucifixo Reto com Halteres", sets: "4 s√©ries", howto: "Isole e defina o centro do <strong>Peitoral Maior</strong>." },
                                { name: "Voador em P√© no Cabo", sets: "3 s√©ries", howto: "Trabalha o <strong>Peitoral Maior</strong> e <strong>Peitoral Menor</strong> de forma isolada." },
                                { name: "Voador Curvado em P√© no Cabo", sets: "3 s√©ries", howto: "Este exerc√≠cio foca no <strong>Peitoral Maior</strong> e <strong>Peitoral Menor</strong> em diferentes √¢ngulos." }
                            ]
                        },
                        {
                            name: "Tr√≠ceps",
                            series: 9, // 3 exerc√≠cios * 3 s√©ries = 9
                            muscles: "tr√≠ceps, tr√≠ceps braquial",
                            exercises: [
                                { name: "Tr√≠ceps Franc√™s com Halteres", sets: "3 s√©ries", howto: "Ativando todas as cabe√ßas do <strong>Tr√≠ceps Braquial (cabe√ßa longa, medial, lateral)</strong>." },
                                { name: "Tr√≠ceps Invertido na Polia (Cabo)", sets: "3 s√©ries", howto: "Isole o <strong>Tr√≠ceps Braquial</strong>, com foco nas cabe√ßas lateral e medial." },
                                { name: "Tr√≠ceps na Polia (Cabo)", sets: "3 s√©ries", howto: "Cl√°ssico para volume e defini√ß√£o do <strong>Tr√≠ceps Braquial</strong>." }
                            ]
                        }
                    ]
                },
                sabado_ombros_trapezio: { // Treino para S√°bado
                    title: "üí™ TREINO OMBROS + TRAP√âZIO ‚Äì S√ÅBADO (27 S√âRIES)",
                    series: 27,
                    objective: "Desenvolver ombros largos e definidos, com trap√©zio imponente, melhorando a postura, estabilidade do tronco e o balan√ßo dos bra√ßos durante a corrida.",
                    groups: [
                        {
                            name: "Ombros",
                            series: 18, // 6 exerc√≠cios * 3 s√©ries = 18
                            muscles: "ombros, deltoide, deltoide anterior, lateral, posterior, tr√≠ceps braquial, romboide maior, redondo menor",
                            exercises: [
                                { name: "Eleva√ß√£o Lateral com Halteres", sets: "3 s√©ries", howto: "Ativando principalmente o <strong>Deltoide (cabe√ßa m√©dia)</strong> e secundariamente o <strong>Trap√©zio (superior)</strong>." },
                                { name: "Eleva√ß√£o Frontal com Placa", sets: "3 s√©ries", howto: "Focando no <strong>Deltoide (cabe√ßa anterior)</strong>." },
                                { name: "Eleva√ß√£o Frontal com Barra", sets: "3 s√©ries", howto: "Trabalha o <strong>Deltoide (cabe√ßa anterior)</strong>." },
                                { name: "Desenvolvimento (Pegada Aberta) com Barra", sets: "3 s√©ries", howto: "Trabalhando todas as cabe√ßas do <strong>Deltoide</strong>, <strong>Tr√≠ceps Braquial</strong> e <strong>Trap√©zio</strong>." },
                                { name: "Crucifixo Inverso com Halteres", sets: "3 s√©ries", howto: "Isole e defina seus <strong>Deltoide (cabe√ßa posterior)</strong>, ativando tamb√©m <strong>Romboide Maior</strong> e <strong>Redondo Menor</strong>." },
                                { name: "Puxada no Rosto no Cabo", sets: "3 s√©ries", howto: "√ìtimo para o <strong>Deltoide (cabe√ßa posterior)</strong> e para ativar o <strong>Trap√©zio</strong> e <strong>Romboide Maior</strong>." }
                            ]
                        },
                        {
                            name: "Trap√©zio",
                            series: 9, // 3 exerc√≠cios * 3 s√©ries = 9
                            muscles: "trap√©zio, trap√©zio superior e m√©dio, deltoide (cabe√ßa lateral e anterior)",
                            exercises: [
                                { name: "Encolhimento de Ombros com Halteres", sets: "3 s√©ries", howto: "Construa um <strong>Trap√©zio (superior)</strong> imponente e denso." },
                                { name: "Remada para Cima com Barra (Upright Row)", sets: "3 s√©ries", howto: "Ativa o <strong>Trap√©zio (superior e m√©dio)</strong> e o <strong>Deltoide (cabe√ßa lateral e anterior)</strong>." },
                                { name: "Remada Alta com Barra", sets: "3 s√©ries", howto: "Ativa o <strong>Trap√©zio (superior e m√©dio)</strong> e <strong>Deltoide (cabe√ßa lateral e anterior)</strong>." }
                            ]
                        }
                    ]
                },
                domingo_inferiores_a: {
                    title: "üèãÔ∏è‚Äç‚ôÇÔ∏è TREINO INFERIORES A ‚Äì DOMINGO (30 S√âRIES)",
                    series: 30,
                    objective: "Foco: Gl√∫teo, Quadr√≠ceps, Posteriores e Core",
                    groups: [
                        {
                            name: "Gl√∫teos",
                            series: 6, // 2 exerc√≠cios * 3 s√©ries = 6
                            muscles: "gl√∫teos, gl√∫teo m√°ximo, gl√∫teo m√©dio, isquiotibiais, adutores",
                            exercises: [
                                { name: "Hip Thrust com Barra", sets: "3 s√©ries", howto: "Concentre-se na contra√ß√£o do <strong>Gl√∫teo M√°ximo</strong> e <strong>Gl√∫teo M√©dio</strong>, com assist√™ncia dos <strong>Isquiotibiais</strong>." },
                                { name: "Agachamento Sum√¥ com Barra", sets: "3 s√©ries", howto: "Foco principal no <strong>Gl√∫teo M√°ximo</strong> e nos <strong>Adutores</strong>." }
                            ]
                        },
                        {
                            name: "Posterior de Coxa",
                            series: 6, // 2 exerc√≠cios * 3 s√©ries = 6
                            muscles: "posterior de coxa, isquiotibiais, gl√∫teo m√°ximo, lombar",
                            exercises: [
                                { name: "Levantamento Terra com Barra", sets: "3 s√©ries", howto: "Trabalho prim√°rio de <strong>Gl√∫teo M√°ximo</strong>, <strong>Isquiotibiais</strong> e <strong>Lombar</strong>." },
                                { name: "Stiff com Halteres", sets: "3 s√©ries", howto: "Alonga e fortalece os <strong>Isquiotibiais</strong> e o <strong>Gl√∫teo M√°ximo</strong>." }
                            ]
                        },
                        {
                            name: "Panturrilhas",
                            series: 6, // 2 exerc√≠cios * 3 s√©ries = 6
                            muscles: "panturrilhas, gastrocn√™mio, s√≥leo",
                            exercises: [
                                { name: "Panturrilha no Step com Halteres", sets: "3 s√©ries", howto: "Foco principal no <strong>Gastrocn√™mio</strong>." },
                                { name: "Panturrilha no Smith", sets: "3 s√©ries", howto: "Ativa o <strong>S√≥leo</strong> e o <strong>Gastrocn√™mio</strong>." }
                            ]
                        },
                        {
                            name: "Core/Abd√¥men", // This group now accounts for 12 series in Domingo
                            series: 12, // 3 exerc√≠cios * 4 s√©ries = 12
                            muscles: "core, reto abdominal, obl√≠quos, abd√¥men",
                            exercises: [
                                { name: "Eleva√ß√£o de Pernas", sets: "4 s√©ries", howto: "Foco no <strong>Reto Abdominal inferior</strong>." },
                                { name: "Crunch Reto", sets: "4 s√©ries", howto: "Ativa o <strong>Reto Abdominal superior</strong>." },
                                { name: "Abdominal Bicicleta", sets: "4 s√©ries", howto: "Din√¢mico e eficaz para todo o <strong>Reto Abdominal</strong>, <strong>Obl√≠quo Externo</strong> e <strong>Serr√°til Anterior</strong>." }
                            ]
                        }
                    ]
                },
                segunda_costas_antebraco_biceps: { // Treino para Segunda-feira
                    title: "ü¶æ TREINO COSTAS + ANTEBRA√áO + B√çCEPS ‚Äì SEGUNDA-FEIRA (30 S√âRIES)",
                    series: 30,
                    objective: "Desenvolver for√ßa e volume em costas, antebra√ßos e b√≠ceps para um tronco forte e bra√ßos definidos, essenciais para a performance geral.",
                    groups: [
                        {
                            name: "Costas",
                            series: 20, // 5 exerc√≠cios * 4 s√©ries = 20
                            muscles: "costas, lat√≠ssimo do dorso, romboide maior, redondo maior, erector da espinha, b√≠ceps",
                            exercises: [
                                { name: "Remada Curvada com Barra", sets: "4 s√©ries", howto: "Ganhe espessura e for√ßa para suas <strong>Costas (Lat√≠ssimo do Dorso, Romboide Maior, Redondo Maior)</strong>. Ativa tamb√©m o <strong>Erector da Espinha</strong> e <strong>B√≠ceps</strong>." },
                                { name: "Remada Curvada (Pegada Invertida) com Barra", sets: "4 s√©ries", howto: "Trabalha os m√∫sculos das <strong>Costas</strong> de um √¢ngulo diferente, com maior √™nfase no <strong>B√≠ceps</strong>." },
                                { name: "Puxada para Baixo Lateral (Pegada Aberta) no Cabo", sets: "4 s√©ries", howto: "Essencial para a largura e defini√ß√£o do V-shape das costas, ativando principalmente o <strong>Lat√≠ssimo do Dorso</strong> e <strong>Redondo Maior</strong>." },
                                { name: "Puxada para Baixo Lateral (Pegada Invertida) no Cabo", sets: "4 s√©ries", howto: "Foco na ativa√ß√£o do <strong>Lat√≠ssimo do Dorso</strong> e <strong>Redondo Maior</strong>, com maior envolvimento do <strong>B√≠ceps</strong>." },
                                { name: "Remada Sentado no Cabo", sets: "4 s√©ries", howto: "Fortalece o miolo das <strong>Costas</strong> e a postura." }
                            ]
                        },
                        {
                            name: "Antebra√ßo",
                            series: 4, // 2 exerc√≠cios * 2 s√©ries = 4
                            muscles: "antebraco, flexores do punho, extensores do punho",
                            exercises: [
                                { name: "Rosca Punho (com barra ou halter)", sets: "2 s√©ries", howto: "Fortalece os <strong>flexores do punho</strong>." },
                                { name: "Rosca Inversa (com barra ou halter)", sets: "2 s√©ries", howto: "Fortalece os <strong>extensores do punho</strong> e o <strong>braquiorradial</strong>." }
                            ]
                        },
                        {
                            name: "B√≠ceps",
                            series: 6, // 2 exerc√≠cios * 3 s√©ries = 6
                            muscles: "b√≠ceps, b√≠ceps braquial, braquial, braquiorradial",
                            exercises: [
                                { name: "Rosca Direta com Barra", sets: "3 s√©ries", howto: "Construtor de massa para o <strong>B√≠ceps Braquial</strong>." },
                                { name: "Rosca Alternada com Halteres", sets: "3 s√©ries", howto: "Trabalha o <strong>B√≠ceps Braquial</strong> e o <strong>Braquial</strong>." }
                            ]
                        }
                    ]
                }
            },
            runs: {
                // Defini√ß√µes de Pace para Ampaulo - ATUALIZADO
                paceDefinitionsAmpaulo: [
                    { name: "Z1 ‚Äì Recupera√ß√£o Ativa", min_km: "7:31", max_km: "8:30", min_kmh: 7.06, max_kmh: 8.00, description: "Caminhada r√°pida ou trote suave" },
                    { name: "Z2 ‚Äì Ritmo Leve", min_km: "7:00", max_km: "7:30", min_kmh: 8.00, max_kmh: 8.57, description: "Conversa f√°cil, base regenerativa" },
                    { name: "Z3 ‚Äì Ritmo Moderado", min_km: "6:31", max_km: "6:59", min_kmh: 8.58, max_kmh: 9.16, description: "Levemente ofegante, treino aer√≥bico" },
                    { name: "Z4 ‚Äì Ritmo Forte", min_km: "6:00", max_km: "6:30", min_kmh: 9.23, max_kmh: 10.00, description: "Alta intensidade, foco em velocidade" },
                    { name: "Z5 ‚Äì Ritmo M√°ximo", min_km: "5:00", max_km: "5:59", min_kmh: 10.01, max_kmh: 12.00, description: "Sprint m√°ximo, apenas intervalos" }
                ],
                // Defini√ß√µes de Pace para Elo√≠sa (mantendo as anteriores)
                paceDefinitionsEloisa: [
                    { name: "Zona 1 (Z1) - Recupera√ß√£o Ativa", min_km: "8:31", max_km: "9:30", min_kmh: 6.31, max_kmh: 7.05, description: "Ritmo muito leve, permite conversar sem esfor√ßo. Ideal para recupera√ß√£o e aquecimento/desaquecimento." },
                    { name: "Zona 2 (Z2) - Ritmo Leve", min_km: "7:45", max_km: "8:30", min_kmh: 7.06, max_kmh: 7.74, description: "Permite uma conversa confort√°vel, ideal para base aer√≥bica e treinos de volume." },
                    { name: "Zona 3 (Z3) - Ritmo Moderado", min_km: "7:00", max_km: "7:30", min_kmh: 8.00, max_kmh: 8.57, description: "A conversa fica um pouco mais dif√≠cil. Ritmo para melhorar a capacidade aer√≥bica e a resist√™ncia." },
                    { name: "Zona 4 (Z4) - Ritmo Forte", min_km: "6:00", max_km: "6:30", min_kmh: 9.23, max_kmh: 10.00, description: "Alta intensidade, respira√ß√£o ofegante. Usado para intervalos curtos e melhora da velocidade." },
                    { name: "Zona 5 (Z5) - Ritmo M√°ximo/Sprint", min_km: "5:00", max_km: "5:59", min_kmh: 10.01, max_kmh: 12.00, description: "Esfor√ßo m√°ximo, sprint. Apenas para per√≠odos muito curtos. Trabalha pot√™ncia e velocidade explosiva." }
                ],
                // Treinos do Ampaulo - ATUALIZADO com a nova estrutura e tempos
                leve: {
                    title: "üèÉ‚Äç‚ôÇÔ∏è SEGUNDA-FEIRA ‚Äì Corrida Leve (Z1‚ÄìZ3)",
                    schedule: "18h10 ‚Äì 19h00",
                    objective: "Corrida regenerativa com progress√£o leve",
                    estimated_distance: "~6.2 km",
                    total: { duration: "46 min 45 sec", distance: "6.4 km" }, // Adjusted based on sum of stages
                    stages: [
                        { km: "1", name: "Aquecimento", pace: "7:45/km", zone: "Z1", estimated_time: "7:45", observations: "Caminhada r√°pida / trote" },
                        { km: "2", name: "Aquecimento", pace: "7:30/km", zone: "Z2", estimated_time: "7:30", observations: "Trote leve e constante" },
                        { km: "3", name: "Ritmo Moderado", pace: "6:45/km", zone: "Z3", estimated_time: "6:45", observations: "Concentra√ß√£o no ritmo" },
                        { km: "4", name: "Ritmo Leve", pace: "7:00/km", zone: "Z2", estimated_time: "7:00", observations: "Respira√ß√£o tranquila" },
                        { km: "5", name: "Ritmo Moderado", pace: "6:45/km", zone: "Z3", estimated_time: "6:45", observations: "Passada firme e natural" },
                        { km: "6", name: "Ritmo Leve", pace: "7:00/km", zone: "Z2", estimated_time: "7:00", observations: "Foco no conforto final" },
                        { km: "END", name: "Desaquecimento", pace: "7:30/km", zone: "Z2", estimated_time: "3:15 (0.4 km)", observations: "Caminhada + trote leve" }
                    ]
                },
                intervalada: {
                    title: "üèÉ‚Äç‚ôÇÔ∏è QUARTA-FEIRA ‚Äì Corrida Intervalada por Km",
                    schedule: "18h10 ‚Äì 19h00",
                    objective: "Alternar est√≠mulo aer√≥bico e anaer√≥bico leve",
                    estimated_distance: "7.4 ‚Äì 7.6 km",
                    total: { duration: "50 min", distance: "7.4 ‚Äì 7.6 km" },
                    stages: [
                        { km: "1", name: "Aquecimento", pace: "7:00/km", zone: "Z2", estimated_time: "7:00", observations: "Soltar articula√ß√µes" },
                        { km: "2", name: "Aquecimento", pace: "7:30/km", zone: "Z1", estimated_time: "7:30", observations: "Caminhada + trote leve" },
                        { km: "3", name: "Ritmo M√°ximo", pace: "5:30/km", zone: "Z5", estimated_time: "5:30", observations: "For√ßa e explos√£o" },
                        { km: "4", name: "Ritmo Leve", pace: "7:00/km", zone: "Z2", estimated_time: "7:00", observations: "Recupera√ß√£o com respira√ß√£o" },
                        { km: "5", name: "Ritmo Forte", pace: "6:00/km", zone: "Z4", estimated_time: "6:00", observations: "Frequ√™ncia e const√¢ncia" },
                        { km: "6", name: "Ritmo Leve", pace: "7:00/km", zone: "Z2", estimated_time: "7:00", observations: "Estabiliza√ß√£o do esfor√ßo" },
                        { km: "7", name: "Ritmo Forte", pace: "6:00/km", zone: "Z4", estimated_time: "6:00", observations: "Finaliza√ß√£o de est√≠mulo" },
                        { km: "8", name: "Desaquecimento", pace: "7:30/km", zone: "Z1", estimated_time: "4:00‚Äì4:30", observations: "Caminhada leve + trote final" }
                    ]
                },
                longa: {
                    title: "üèÉ‚Äç‚ôÇÔ∏è S√ÅBADO ‚Äì Corrida Longa (Z2‚ÄìZ4)",
                    schedule: "05h20 ‚Äì 06h30",
                    objective: "Construir resist√™ncia e consist√™ncia em ritmo m√©dio",
                    estimated_distance: "10.1 km",
                    total: { duration: "73 min", distance: "11.1 km" }, // Adjusted based on sum of stages
                    stages: [
                        { km: "1", name: "Aquecimento", pace: "7:30/km", zone: "Z2", estimated_time: "7:30", observations: "Ritmo leve para aquecer" },
                        { km: "2", name: "Ritmo Leve", pace: "7:15/km", zone: "Z2", estimated_time: "7:15", observations: "Transi√ß√£o gradual" },
                        { km: "3", name: "Ritmo Moderado", pace: "7:00/km", zone: "Z3", estimated_time: "7:00", observations: "Base s√≥lida" },
                        { km: "4", name: "Ritmo Moderado", pace: "7:00/km", zone: "Z3", estimated_time: "7:00", observations: "Mantendo fluidez" },
                        { km: "5", name: "Ritmo Leve", pace: "7:15/km", zone: "Z2", estimated_time: "7:15", observations: "Fase de recupera√ß√£o ativa" },
                        { km: "6", name: "Ritmo Moderado", pace: "6:50/km", zone: "Z3", estimated_time: "6:50", observations: "Retomando controle" },
                        { km: "7", name: "Ritmo Moderado", pace: "6:45/km", zone: "Z3", estimated_time: "6:45", observations: "Leve acelera√ß√£o" },
                        { km: "8", name: "Ritmo Leve", pace: "7:15/km", zone: "Z2", estimated_time: "7:15", observations: "Ajuste respirat√≥rio" },
                        { km: "9", name: "Ritmo Forte", pace: "6:30/km", zone: "Z4", estimated_time: "6:30", observations: "Est√≠mulo forte final" },
                        { km: "10", name: "Ritmo Moderado", pace: "6:50/km", zone: "Z3", estimated_time: "6:50", observations: "Manter at√© o final" },
                        { km: "10.1", name: "Desaquecimento", pace: "7:30/km", zone: "Z1", estimated_time: "3:50 (1.1 km)", observations: "Caminhada + trote leve" }
                    ]
                },
                // Treino de Corrida para Elo√≠sa (Iniciante)
                segunda_eloisa: {
                    title: "üèÉ‚Äç‚ôÄÔ∏è SEGUNDA ‚Äì TREINO DE CORRIDA ELO√çSA (50 MIN)", // Updated duration
                    stages: [
                        { name: "Aquecimento", duration: "10 min", pace: "Caminhada leve üö∂‚Äç‚ôÄÔ∏è" },
                        { name: "Parte Principal", duration: "8 ciclos de (1 min corrida leve üèÉ‚Äç‚ôÄÔ∏è + 2 min caminhada üö∂‚Äç‚ôÄÔ∏è)", pace: "Ritmo do corpo" },
                        { name: "Desaquecimento", duration: "6 min", pace: "Caminhada leve üö∂‚Äç‚ôÄÔ∏è" }
                    ],
                    total: { duration: "50 minutos", distance: "Ritmo do corpo" } // Updated total
                },
                quarta_eloisa: {
                    title: "üèÉ‚Äç‚ôÄÔ∏è QUARTA ‚Äì TREINO DE CORRIDA ELO√çSA (50 MIN)",
                    stages: [
                        { name: "Aquecimento", duration: "10 min", pace: "Caminhada leve üö∂‚Äç‚ôÄÔ∏è" },
                        { name: "Parte Principal", duration: "10 ciclos de (1 min 30s corrida üèÉ‚Äç‚ôÄÔ∏è + 2 min caminhada üö∂‚Äç‚ôÄÔ∏è)", pace: "Ritmo do corpo" },
                        { name: "Desaquecimento", duration: "5 min", pace: "Caminhada leve üö∂‚Äç‚ôÄÔ∏è" }
                    ],
                    total: { duration: "50 minutos", distance: "Ritmo do corpo" }
                },
                sabado_eloisa: {
                    title: "üèÉ‚Äç‚ôÄÔ∏è S√ÅBADO ‚Äì TREINO DE CORRIDA ELO√çSA (70 MIN)", // Updated duration
                    stages: [
                        { name: "Aquecimento", duration: "10 min", pace: "Caminhada leve üö∂‚Äç‚ôÄÔ∏è" },
                        { name: "Parte Principal", duration: "10 ciclos de (2 min corrida üèÉ‚Äç‚ôÄÔ∏è + 2 min caminhada üö∂‚Äç‚ôÄÔ∏è)", pace: "Ritmo do corpo" },
                        { name: "Desaquecimento", duration: "10 min", pace: "Caminhada leve üö∂‚Äç‚ôÄÔ∏è" }
                    ],
                    total: { duration: "70 minutos", distance: "Ritmo do corpo" } // Updated total
                }
            },
            nutrition: {
                meals: [
                    { name: "Caf√© da Manh√£", items: "135g Cuscuz, 3 Ovos, 2 Bananas, Caf√© (opcional)" },
                    { name: "Almo√ßo", items: "160g Arroz, 130g Feij√£o, 100-150g Prote√≠na Magra, Vegetais, 100g Mel√£o" },
                    { name: "Jantar", items: "135g Cuscuz, 3 Ovos, 2 Bananas" },
                ],
                isotonic: {
                    title: "üíß Bebida Isot√¥nica Caseira",
                    recipe: "500ml de √°gua, suco de 1 lim√£o, 1 pitada de sal, 1 colher de sopa de mel (opcional)."
                },
                macros: [
                    { meal: "Caf√© da Manh√£", protein: 26.2, carbs: 78.7, fat: 16.8, kcal: 560 },
                    { meal: "Almo√ßo", protein: "62.4 - 65.4", carbs: "84.8 - 89.8", fat: "6.9 - 7.4", kcal: "694 - 757" },
                    { meal: "Jantar", protein: 26.2, carbs: 78.7, fat: 16.8, kcal: 560 },
                ],
                total: { protein: 114.8, carbs: 242.2, fat: 41.0, kcal: 1797 },
                naturalImmunity: {
                    title: "üí™ Refor√ßo Imunol√≥gico Natural no Inverno",
                    sections: [
                        {
                            heading: "Para o Corredor no Frio:",
                            items: [
                                "‚úÖ <strong>Uso de m√°scara fina ou bandana</strong> cobrindo nariz e boca durante a corrida no frio intenso. Isso aquece e umidifica o ar, protegendo as vias a√©reas.",
                                "‚úÖ <strong>Aque√ßa dentro de casa</strong> por 5 minutos antes de sair (polichinelos, corrida estacion√°ria).",
                                "‚úÖ <strong>Treine a respira√ß√£o nasal</strong> no in√≠cio da corrida. O nariz √© o filtro e aquecedor natural do ar."
                            ]
                        },
                        {
                            heading: "Suplementos Naturais e H√°bitos:",
                            items: [
                                "üçØ <strong>Mel com pr√≥polis:</strong> 1 colher de ch√° de mel com 5-10 gotas de extrato de pr√≥polis (1x/dia). Potente antimicrobiano e anti-inflamat√≥rio.",
                                "üçä <strong>Vitamina C natural:</strong> Suco de acerola, laranja, lim√£o, kiwi. Ou suplemento (500mg/dia), se indicado.",
                                "üßÑ <strong>Alho cru picado:</strong> 1 dente pequeno por dia (com comida, se tolerar). Poderoso antiviral e antibacteriano.",
                                "‚òÄÔ∏è <strong>Vitamina D:</strong> Mantenha a suplementa√ß√£o conforme orienta√ß√£o profissional para n√≠veis acima de 30-40 ng/mL, essencial para a imunidade.",
                                "üò¥ <strong>Sono de qualidade:</strong> Priorize 7-9 horas de sono por noite para a recupera√ß√£o e fortalecimento imunol√≥gico."
                            ]
                        },
                        {
                            heading: "Sinais de Alerta (Quando Procurar M√©dico):",
                            items: [
                                "Dor forte ao engolir que persiste.",
                                "Febre ou calafrios.",
                                "Pus nas am√≠gdalas.",
                                "Tosse persistente com catarro espesso ou altera√ß√£o de cor.",
                                "Sintomas que n√£o melhoram em 3 dias com as medidas caseiras."
                            ]
                        }
                    ]
                }
            },
            // Dados de progresso - agora inicializados aqui no escopo global
            progress: {
                dates: ['10/01/2024', '31/07/2024', '05/05/2025'],
                weight: [98.7, 92.8, 96.8],
                fatPercentage: [24.9, 16.4, 19.5],
                fatMass: [24.5, 15.3, 18.9],
                leanMass: [74.2, 77.5, 77.9],
                waist: [93, 87, 93],
                abdomen: [100, 93, 96],
                skinfolds: {
                    labels: ['Tricipital', 'Abdominal', 'Subescapular', 'Axilar M√©dia', 'Tor√°cica', 'Suprail√≠aca'],
                    data: [
                        [45, 40, 35, 25, 20, 20], // 10/01/2024
                        [11.2, 30, 23.6, 12.4, 9.5, 14.7], // 31/07/2024
                        [12, 32, 30, 16, 15, 20]  // 05/05/2025
                    ]
                }
            },
            calendar: (() => {
                const julyDays = 31; // July has 31 days
                const daysData = [];
                // July 1, 2025 is a Tuesday (getDay() returns 2)
                // Update calendar activities to reflect the new workout schedule
                const newCalendarActivities = [
                    { day: 1, weekday: "Ter√ßa-feira", activity: "MUSCULA√á√ÉO: TREINO INFERIORES B", msg: "Mantenha o foco e a disciplina.", verse: "Prov√©rbios 3:6" }, // Original Tuesday activity
                    { day: 2, weekday: "Quarta-feira", activity: "MUSCULA√á√ÉO: TREINO INFERIORES B<br>CORRIDA INTERVALADA (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "Postura e for√ßa para seus ombros! Mantenha a forma.", verse: "Prov√©rbios 21:5" }, // Updated for Wednesday
                    { day: 3, weekday: "Quinta-feira", activity: "CORRIDA INTERVALADA (7 KM)", msg: "Desafie seus limites de velocidade e resist√™ncia. Avance!", verse: "Romanos 12:21" }, // Original Thursday activity
                    { day: 4, weekday: "Sexta-feira", activity: "MUSCULA√á√ÉO: TREINO PEITO + TR√çCEPS", msg: "Core forte, costas poderosas. O centro do seu poder!", verse: "Prov√©rbios 14:23" },
                    { day: 5, weekday: "S√°bado", activity: "MUSCULA√á√ÉO: TREINO OMBROS + TRAP√âZIO<br>CORRIDA LONGA (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "Resist√™ncia e estrat√©gia na sua corrida mais longa! Conquiste!", verse: "Hebreus 12:1" }, // Updated for Saturday
                    { day: 6, weekday: "Domingo", activity: "MUSCULA√á√ÉO: TREINO INFERIORES A", msg: "Um novo ciclo de for√ßa come√ßa hoje! D√™ o seu melhor.", verse: "Salmos 28:7" },
                    { day: 7, weekday: "Segunda-feira", activity: "MUSCULA√á√ÉO: TREINO COSTAS + ANTEBRA√áO + B√çCEPS<br>CORRIDA LEVE (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "Construa sua for√ßa de cima para baixo. Foco e execu√ß√£o!", verse: "Filipenses 4:13" }, // Updated for Monday
                    { day: 8, weekday: "Ter√ßa-feira", activity: "MUSCULA√á√ÉO: TREINO INFERIORES B", msg: "Supere-se! Cada treino √© uma oportunidade de ir al√©m.", verse: "Colossenses 3:23" }, // Original Tuesday activity
                    { day: 9, weekday: "Quarta-feira", activity: "MUSCULA√á√ÉO: TREINO INFERIORES B<br>CORRIDA INTERVALADA (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "Foco nos ombros e trap√©zio, base para tudo. Construa sua for√ßa.", verse: "Lucas 16:10" }, // Updated for Wednesday
                    { day: 10, weekday: "Quinta-feira", activity: "CORRIDA INTERVALADA (7 KM)", msg: "Seu corpo √© seu templo. Honre-o com a dedica√ß√£o que ele merece.", verse: "1 Cor√≠ntios 6:19" }, // Original Thursday activity
                    { day: 11, weekday: "Sexta-feira", activity: "MUSCULA√á√ÉO: TREINO PEITO + TR√çCEPS", msg: "Aproxime-se do fim de semana com a sensa√ß√£o de dever cumprido.", verse: "Prov√©rbios 9:10" },
                    { day: 12, weekday: "S√°bado", activity: "MUSCULA√á√ÉO: TREINO OMBROS + TRAP√âZIO<br>CORRIDA LONGA (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "A corrida longa testa sua mente e fortalece seu esp√≠rito.", verse: "Josu√© 1:9" }, // Updated for Saturday
                    { day: 13, weekday: "Domingo", activity: "MUSCULA√á√ÉO: TREINO INFERIORES A", msg: "Descanse bem, reflita sobre seu progresso e agrade√ßa.", verse: "1 Pedro 5:7" },
                    { day: 14, weekday: "Segunda-feira", activity: "MUSCULA√á√ÉO: TREINO COSTAS + ANTEBRA√áO + B√çCEPS<br>CORRIDA LEVE (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "Nova semana, novas metas. Mantenha o ritmo.", verse: "Salmos 37:5" }, // Updated for Monday
                    { day: 15, weekday: "Ter√ßa-feira", activity: "MUSCULA√á√ÉO: TREINO INFERIORES B", msg: "Cada passo conta. Siga em frente com determina√ß√£o.", verse: "Prov√©rbios 24:16" }, // Original Tuesday activity
                    { day: 16, weekday: "Quarta-feira", activity: "MUSCULA√á√ÉO: TREINO INFERIORES B<br>CORRIDA INTERVALADA (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "A for√ßa vem de dentro. Acredite no seu potencial.", verse: "Isa√≠as 41:10" }, // Updated for Wednesday
                    { day: 17, weekday: "Quinta-feira", activity: "CORRIDA INTERVALADA (7 KM)", msg: "Desafie seus limites. O progresso est√° na supera√ß√£o.", verse: "Filipenses 3:14" }, // Original Thursday activity
                    { day: 18, weekday: "Sexta-feira", activity: "MUSCULA√á√ÉO: TREINO PEITO + TR√çCEPS", msg: "Foco na forma e na t√©cnica. Qualidade acima de tudo.", verse: "Ef√©sios 4:29" },
                    { day: 19, weekday: "S√°bado", activity: "MUSCULA√á√ÉO: TREINO OMBROS + TRAP√âZIO<br>CORRIDA LONGA (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "Sua dedica√ß√£o √© inspiradora. Continue firme no caminho.", verse: "G√°latas 6:9" }, // Updated for Saturday
                    { day: 20, weekday: "Domingo", activity: "MUSCULA√á√ÉO: TREINO INFERIORES A", msg: "Recupere-se e prepare-se para a pr√≥xima semana de vit√≥rias.", verse: "Mateus 11:28" },
                    { day: 21, weekday: "Segunda-feira", activity: "MUSCULA√á√ÉO: TREINO COSTAS + ANTEBRA√áO + B√çCEPS<br>CORRIDA LEVE (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "Recomece com garra. A cada dia, um novo recorde pessoal.", verse: "2 Tim√≥teo 1:7" }, // Updated for Monday
                    { day: 22, weekday: "Ter√ßa-feira", activity: "MUSCULA√á√ÉO: TREINO INFERIORES B", msg: "Sua resist√™ncia aumenta a cada passo. N√£o desista!", verse: "Romanos 5:3-4" }, // Original Tuesday activity
                    { day: 23, weekday: "Quarta-feira", activity: "MUSCULA√á√ÉO: TREINO INFERIORES B<br>CORRIDA INTERVALADA (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "Construa seu corpo com prop√≥sito e disciplina.", verse: "1 Cor√≠ntios 9:27" }, // Updated for Wednesday
                    { day: 24, weekday: "Quinta-feira", activity: "CORRIDA INTERVALADA (7 KM)", msg: "A mente forte leva o corpo a lugares incr√≠veis.", verse: "Prov√©rbios 4:23" }, // Original Thursday activity
                    { day: 25, weekday: "Sexta-feira", activity: "MUSCULA√á√ÉO: TREINO PEITO + TR√çCEPS", msg: "√öltimo treino de for√ßa do m√™s. D√™ tudo de si. Celebre a sua for√ßa!", verse: "1 Tessalonicenses 5:18" },
                    { day: 26, weekday: "S√°bado", activity: "MUSCULA√á√ÉO: TREINO OMBROS + TRAP√âZIO<br>CORRIDA LONGA (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "Voc√™ chegou ao final do m√™s com excel√™ncia. Orgulhe-se de cada passo!", verse: "Filipenses 4:4" }, // Updated for Saturday
                    { day: 27, weekday: "Domingo", activity: "MUSCULA√á√ÉO: TREINO INFERIORES A", msg: "Dia de avalia√ß√£o e gratid√£o. Prepare-se para um novo m√™s ainda mais forte!", verse: "Salmos 9:1" },
                    { day: 28, weekday: "Segunda-feira", activity: "MUSCULA√á√ÉO: TREINO COSTAS + ANTEBRA√áO + B√çCEPS<br>CORRIDA LEVE (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "Fechando o m√™s com chave de ouro e abrindo caminho para novas conquistas. Parab√©ns pela sua dedica√ß√£o!", verse: "1 Cor√≠ntios 15:58" }, // Updated for Monday
                    { day: 29, weekday: "Ter√ßa-feira", activity: "MUSCULA√á√ÉO: TREINO INFERIORES B", msg: "Mantenha o foco e a disciplina.", verse: "Prov√©rbios 3:6" },
                    { day: 30, weekday: "Quarta-feira", activity: "MUSCULA√á√ÉO: TREINO INFERIORES B<br>CORRIDA INTERVALADA (Ampaulo) / TREINO DE CORRIDA (Elo√≠sa)", msg: "Mantenha o foco e a disciplina.", verse: "Prov√©rbios 3:6" },
                    { day: 31, weekday: "Quinta-feira", activity: "CORRIDA INTERVALADA (7 KM)", msg: "Mantenha o foco e a disciplina.", verse: "Prov√©rbios 3:6" }
                ];

                const existingDataMap = new Map();
                newCalendarActivities.forEach(item => {
                    existingDataMap.set(item.day, item);
                });

                for (let i = 1; i <= julyDays; i++) {
                    const date = new Date(2025, 6, i); // Month is 0-indexed (July is 6)
                    const weekdayName = getDayName(date);

                    if (existingDataMap.has(i)) {
                        daysData.push(existingDataMap.get(i)); // Use get(i) to retrieve the object
                    } else {
                        // Fallback for days not explicitly defined in newCalendarActivities
                        daysData.push({
                            day: i,
                            weekday: weekdayName,
                            activity: "Dia de Atividade Livre",
                            msg: "Mantenha-se ativo e focado nos seus objetivos.",
                            verse: "Prov√©rbios 3:6"
                        });
                    }
                }
                return daysData;
            })(),
            weeklySchedule: [
                { day: "Quarta-feira", schedule: [
                    {time: "05:20-06:30", task: "üí™ MUSCULA√á√ÉO: TREINO INFERIORES B"},
                    {time: "18:10-19:00", task: "üèÉ‚Äç‚ôÇÔ∏è CORRIDA INTERVALADA (Ampaulo) / üèÉ‚Äç‚ôÄÔ∏è TREINO DE CORRIDA (Elo√≠sa)"}, // Added running for Wednesday
                    {time: "21:00-22:00", task: "üìö ESTUDO"},
                    {time: "20:00-20:30", task: "üìñ LEITURA B√çBLICA EM FAM√çLIA"}
                ]},
                { day: "Sexta-feira", schedule: [
                    {time: "05:20-06:30", task: "üèãÔ∏è‚Äç‚ôÇÔ∏è MUSCULA√á√ÉO: TREINO PEITO + TR√çCEPS"},
                    {time: "21:00-22:00", task: "üìö ESTUDO"},
                    {time: "20:00-20:30", task: "üìñ LEITURA B√çBLICA EM FAM√çLIA"}
                ]},
                { day: "S√°bado", schedule: [
                    {time: "07:10-08:10", task: "üí™ MUSCULA√á√ÉO: TREINO OMBROS + TRAP√âZIO"},
                    {time: "05:20-06:30", task: "üèÉ‚Äç‚ôÇÔ∏è CORRIDA LONGA (Ampaulo) / üèÉ‚Äç‚ôÄÔ∏è TREINO DE CORRIDA (Elo√≠sa)"}, // Added running for Saturday
                    {time: "14:20-17:00", task: "üë®‚Äçüë©‚Äçüë¶ AULAS DOS FILHOS"},
                    {time: "20:00-20:30", task: "üìñ LEITURA B√çBLICA EM FAM√çLIA"}
                ]},
                { day: "Domingo", schedule: [
                    {time: "06:00-07:10", task: "üèãÔ∏è‚Äç‚ôÇÔ∏è MUSCULA√á√ÉO: TREINO INFERIORES A"},
                    {time: "09:00-11:20", task: "üôè ESCOLA B√çBLICA DOMINICAL"},
                    {time: "18:30-20:00", task: "üôè CULTO NA IGREJA"}
                ]},
                { day: "Segunda-feira", schedule: [
                    {time: "05:20-06:30", task: "ü¶æ MUSCULA√á√ÉO: TREINO COSTAS + ANTEBRA√áO + B√çCEPS"},
                    {time: "05:20-06:00", task: "üèÉ‚Äç‚ôÇÔ∏è CORRIDA LEVE (Ampaulo) / üèÉ‚Äç‚ôÄÔ∏è TREINO DE CORRIDA (Elo√≠sa)"}, // Added running for Monday
                    {time: "21:00-22:00", task: "üìö ESTUDO"},
                    {time: "20:00-20:30", task: "üìñ LEITURA B√çBLICA EM FAM√çLIA"}
                ]},
                { day: "Ter√ßa-feira", schedule: [
                    {time: "05:20-06:00", task: "üèÉ‚Äç‚ôÇÔ∏è CORRIDA LEVE"}, // Original Tuesday running
                    {time: "20:00-20:45", task: "üôè CULTO EM FAM√çLIA EM NOSSA CASA"}
                ]},
                { day: "Quinta-feira", schedule: [
                    {time: "05:20-06:10", task: "üèÉ‚Äç‚ôÇÔ∏è CORRIDA INTERVALADA"}, // Original Thursday running
                    {time: "19:30-21:00", task: "üôè CULTO PG ATALAIA"}
                ]}
            ],
            finances: {
                billPayments: [ // Only Vencimentos
                    { name: "Vencimento Fatura Energia (Coelba)", day: 3, type: "Vencimento" },
                    { name: "Vencimento Fatura Cart√£o Inter", day: 7, type: "Vencimento" },
                    { name: "Vencimento Cons√≥rcio Biz (Honda)", day: 10, type: "Vencimento" }, // New entry
                    { name: "Vencimento Fatura Cart√£o C6Bank", day: 20, type: "Vencimento" },
                    { name: "Vencimento Fatura Internet (Netcenter)", day: 20, type: "Vencimento" },
                    { name: "Vencimento Fatura PicPay", day: 25, type: "Vencimento" }, // Corrected name
                    { name: "Vencimento Fatura √Ågua (Embasa)", day: 30, type: "Vencimento" }
                ].sort((a, b) => {
                    // Sort by day first
                    if (a.day !== b.day) {
                        return a.day - b.day;
                    }
                    // If days are the same, sort by name to maintain consistent order as per user's list
                    return a.name.localeCompare(b.name);
                }),
                creditCardInfo: [ // For Fechamento dates and other card info
                    { name: "Cart√£o Inter", closingDay: 30, maturityDay: 7 },
                    { name: "Cart√£o C6Bank", closingDay: 10, maturityDay: 20 },
                    { name: "Cart√£o PicPay", closingDay: 15, maturityDay: 25 }
                ].sort((a, b) => a.maturityDay - b.maturityDay), // Sort by maturityDay
                salaryDetails: {
                    salaryDay: 5, // 5¬∫ dia √∫til
                    advanceDay: 20 // Dia 20
                }
            }
        };
    </script>

    <!-- Firebase SDK - Importa√ß√£o dos m√≥dulos necess√°rios -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Vari√°veis globais para Firebase (ser√£o preenchidas ao carregar)
        let app;
        let db;
        let auth;
        let userId;

        // Dados do perfil do usu√°rio (passa a ser reativo ao Firestore)
        window.userProfile = {
            name: "Convidado", // Padr√£o antes de carregar
            gender: "nao-informar",
            dob: "1990-01-01",
            height: 0,
            currentWeight: 0,
            idealWeight: 0,
            email: "",
            phone: ""
        };

        // Fun√ß√£o de inicializa√ß√£o do Firebase e autentica√ß√£o
        async function initializeFirebaseAndAuth() {
            try {
                console.log("Iniciando Firebase e Autentica√ß√£o...");
                // Acessa as vari√°veis globais fornecidas pelo ambiente Canvas
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');

                if (Object.keys(firebaseConfig).length === 0) {
                    console.warn("Firebase config n√£o encontrada. Os dados n√£o ser√£o persistidos.");
                    // Continua sem Firebase se a configura√ß√£o n√£o estiver dispon√≠vel
                    document.dispatchEvent(new Event('firebaseAuthReady')); // Dispara evento mesmo sem Firebase
                    return;
                }

                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Autenticar o usu√°rio
                if (typeof __initial_auth_token !== 'undefined') {
                    await signInWithCustomToken(auth, __initial_auth_token);
                    console.log("Autenticado com token personalizado.");
                } else {
                    await signInAnonymously(auth);
                    console.log("Autenticado anonimamente.");
                }

                // Escutar mudan√ßas no estado de autentica√ß√£o
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("UserID:", userId);
                        // Carregar dados do usu√°rio e progresso ap√≥s autentica√ß√£o
                        await window.loadUserProfileFromFirestore();
                        await window.loadProgressDataFromFirestore();
                        // Dispara um evento quando o Firebase e a autentica√ß√£o estiverem prontos
                        document.dispatchEvent(new Event('firebaseAuthReady'));
                    } else {
                        userId = null;
                        console.log("Usu√°rio deslogado.");
                    }
                });

            } catch (error) {
                console.error("Erro ao inicializar Firebase ou autenticar:", error);
            }
        }

        // Chamar a fun√ß√£o de inicializa√ß√£o do Firebase quando o DOM estiver carregado
        document.addEventListener('DOMContentLoaded', initializeFirebaseAndAuth);

        // Fun√ß√µes para Firestore
        window.saveUserProfileToFirestore = async () => {
            if (!userId || !db) { console.warn("Usu√°rio n√£o autenticado ou Firestore n√£o inicializado. N√£o √© poss√≠vel salvar o perfil."); return; }
            const userDocRef = doc(db, `artifacts/${typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'}/users/${userId}/profile`, 'user-data');
            try {
                await setDoc(userDocRef, window.userProfile, { merge: true });
                console.log("Perfil do usu√°rio salvo com sucesso no Firestore!");
            } catch (e) {
                console.error("Erro ao salvar perfil do usu√°rio:", e);
            }
        };

        window.loadUserProfileFromFirestore = async () => {
            return new Promise((resolve) => {
                if (!userId || !db) { console.warn("Usu√°rio n√£o autenticado ou Firestore n√£o inicializado. N√£o √© poss√≠vel carregar o perfil."); resolve(); return; }
                const userDocRef = doc(db, `artifacts/${typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'}/users/${userId}/profile`, 'user-data');
                onSnapshot(userDocRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        Object.assign(window.userProfile, data);
                        console.log("Perfil do usu√°rio carregado do Firestore:", window.userProfile);
                        // Atualiza os campos do formul√°rio
                        document.getElementById('user-name').value = window.userProfile.name;
                        document.getElementById('user-gender').value = window.userProfile.gender;
                        document.getElementById('user-dob').value = window.userProfile.dob;
                        document.getElementById('user-height').value = window.userProfile.height;
                        document.getElementById('user-current-weight').value = window.userProfile.currentWeight;
                        document.getElementById('user-ideal-weight').value = window.userProfile.idealWeight;
                        document.getElementById('user-email').value = window.userProfile.email;
                        document.getElementById('user-phone').value = window.userProfile.phone;

                    } else {
                        console.log("Nenhum perfil de usu√°rio encontrado no Firestore. Usando valores padr√£o.");
                    }
                    resolve();
                }, (error) => {
                    console.error("Erro ao carregar perfil do usu√°rio:", error);
                    resolve();
                });
            });
        };

        window.saveProgressDataToFirestore = async () => {
            if (!userId || !db) { console.warn("Usu√°rio n√£o autenticado ou Firestore n√£o inicializado. N√£o √© poss√≠vel salvar o progresso."); return; }
            const progressDocRef = doc(db, `artifacts/${typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'}/users/${userId}/progress`, 'progress-data');
            try {
                // Converta o objeto progress para JSON antes de salvar, para lidar com arrays aninhados
                await setDoc(progressDocRef, { data: JSON.stringify(window.projectData.progress) }, { merge: true });
                console.log("Dados de progresso salvos com sucesso no Firestore!");
            } catch (e) {
                console.error("Erro ao salvar dados de progresso:", e);
            }
        };

        window.loadProgressDataFromFirestore = async () => {
            return new Promise((resolve) => {
                if (!userId || !db) { console.warn("Usu√°rio n√£o autenticado ou Firestore n√£o inicializado. N√£o √© poss√≠vel carregar o progresso."); resolve(); return; }
                const progressDocRef = doc(db, `artifacts/${typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'}/users/${userId}/progress`, 'progress-data');
                onSnapshot(progressDocRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        if (data.data) {
                            // Parse o JSON de volta para objeto
                            Object.assign(window.projectData.progress, JSON.parse(data.data));
                            console.log("Dados de progresso carregados do Firestore:", window.projectData.progress);
                            renderProgressTable(); // Renderiza a tabela com os dados carregados
                        }
                    } else {
                        console.log("Nenhum dado de progresso encontrado. Usando dados padr√£o.");
                    }
                    resolve();
                }, (error) => {
                    console.error("Erro ao carregar dados de progresso:", error);
                    resolve();
                });
            });
        };
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        .nav-button {
            transition: all 0.3s ease;
        }
        .nav-button.active {
            background-color: #0d9488; /* teal-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .view {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .view.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 40vh;
            width: 100%;
            max-width: 800px;
        }
        /* Styles for main workout accordions */
        .workout-accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
            overflow-y: auto; /* Enable vertical scrolling */
            overflow-x: hidden; /* Prevent horizontal scroll unless necessary for child elements */
        }
        .workout-accordion-button.open + .workout-accordion-content {
            max-height: 2000px; /* Sufficiently large to cover all content, will be limited by actual scrollHeight */
        }
        /* Styles for nested group accordions */
        .group-accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
            overflow-y: auto; /* Enable vertical scrolling for group content */
            overflow-x: auto; /* Enable horizontal scrolling for exercises if text overflows */
        }
        .group-accordion-button.open + .group-accordion-content {
            max-height: 2000px; /* Sufficiently large to cover all content, will be limited by actual scrollHeight */
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #0d9488; /* teal-600 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Table styling for alternating rows */
        .run-table thead tr {
            background-color: #1f2937; /* Darker header background */
            color: #ffffff; /* White text for header */
        }
        .run-table tbody tr:nth-child(odd) {
            background-color: #f8fafc; /* Light gray for odd rows */
        }
        .run-table tbody tr:nth-child(even) {
            background-color: #ffffff; /* White for even rows */
        }
        .run-table tbody tr {
            transition: background-color 0.2s ease-in-out;
        }
        .run-table tbody tr:hover {
            background-color: #e0f2f7; /* Very light teal on hover */
        }
        /* Ensures vertical scrolling for the table content if it overflows */
        .run-table-wrapper {
            overflow-x: auto; /* Horizontal scrollbar if table content is too wide */
            overflow-y: auto; /* Vertical scrollbar if table content is too tall */
            max-height: 400px; /* Example max height for table wrapper, adjust as needed */
        }

        /* Style for editable cells */
        [contenteditable="true"] {
            min-width: 50px; /* Ensure editable cells have a minimum width */
            padding: 4px;
            border: 1px dashed #ccc;
            outline: none;
            cursor: text;
        }
        [contenteditable="true"]:focus {
            border-color: #0d9488;
            background-color: #e0f2f7;
        }

        /* Styles for sub-navigation buttons within "Corrida" view */
        .sub-nav-button {
            transition: all 0.3s ease;
        }
        .sub-nav-button.active {
            background-color: #0d9488; /* teal-600 */
            color: white;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .run-content-section {
            display: none;
        }
        .run-content-section.active {
            display: block;
        }

        /* Calendar specific styles for better visibility */
        .calendar-day {
            min-height: 96px; /* Equivalent to h-24, but flexible */
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: flex-start;
            text-align: left;
            padding: 0.5rem; /* Add some padding */
            box-sizing: border-box; /* Include padding in element's total width and height */
            /* Remove truncate to allow activity text to wrap */
        }

        .calendar-day .font-bold {
            align-self: flex-end; /* Push day number to top right */
        }
        .calendar-day .text-xs {
            margin-top: 0.25rem; /* Space between day number and activity */
            line-height: 1.2; /* Adjust line height for better readability */
            white-space: normal; /* Allow text to wrap */
            overflow: visible; /* Ensure content is not hidden */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="app" class="min-h-screen">
        <!-- Header -->
        <header class="bg-white shadow-sm sticky top-0 z-40">
            <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
                <h1 class="text-2xl font-bold text-slate-900">üöÄ PROJETO AMPAULO ‚Äì Painel de Bordo</h1>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white shadow-md mb-8 sticky top-[72px] z-30">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-wrap justify-center items-center gap-2 py-2">
                    <button data-target="home" class="nav-button active text-sm font-medium py-2 px-4 rounded-full bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">üè† Home</button>
                    <button data-target="hoje" class="nav-button text-sm font-medium py-2 px-4 rounded-full bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">üìÖ Hoje</button>
                    <button data-target="amanha" class="nav-button text-sm font-medium py-2 px-4 rounded-full bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">‚û°Ô∏è Amanh√£</button>
                    <button data-target="treino" class="nav-button text-sm font-medium py-2 px-4 rounded-full bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">üèãÔ∏è‚Äç‚ôÇÔ∏è Treino</button>
                    <button data-target="corrida" class="nav-button text-sm font-medium py-2 px-4 rounded-full bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">üèÉ‚Äç‚ôÇÔ∏è Corrida</button>
                    <button data-target="nutricao" class="nav-button text-sm font-medium py-2 px-4 rounded-full bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">ü•ó Nutri√ß√£o</button>
                    <button data-target="progresso" class="nav-button text-sm font-medium py-2 px-4 rounded-full bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">üìä Progresso</button>
                    <button data-target="calendario" class="nav-button text-sm font-medium py-2 px-4 rounded-full bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">üóìÔ∏è Calend√°rio</button>
                    <button data-target="financas" class="nav-button text-sm font-medium py-2 px-4 rounded-full bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">üí∞ Finan√ßas</button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
            <!-- View: Home (Dados Cadastrais) -->
            <div id="home" class="view active">
                <div class="bg-white p-8 rounded-lg shadow-md mb-8">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4 text-center">üëã Bem-vindo(a) ao Projeto Ampaulo!</h2>
                    <p class="text-slate-600 mb-6 text-center max-w-2xl mx-auto">Este √© o seu guia mensal de alta performance. Preencha seus dados para personalizarmos ainda mais a sua experi√™ncia e come√ßarmos essa jornada juntos!</p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="user-name" class="block text-sm font-medium text-slate-700">Nome:</label>
                            <input type="text" id="user-name" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2" value="Ampaulo">
                        </div>
                        <div>
                            <label for="user-gender" class="block text-sm font-medium text-slate-700">Sexo:</label>
                            <select id="user-gender" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2">
                                <option value="masculino">Masculino</option>
                                <option value="feminino">Feminino</option>
                                <option value="nao-informar">N√£o Informar</option>
                            </select>
                        </div>
                        <div>
                            <label for="user-dob" class="block text-sm font-medium text-slate-700">Data de Nascimento:</label>
                            <input type="date" id="user-dob" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2" value="1990-01-01">
                        </div>
                        <div>
                            <label for="user-height" class="block text-sm font-medium text-slate-700">Altura (cm):</label>
                            <input type="number" id="user-height" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2" value="180">
                        </div>
                        <div>
                            <label for="user-current-weight" class="block text-sm font-medium text-slate-700">Peso Atual (kg):</label>
                            <input type="number" step="0.1" id="user-current-weight" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2" value="97.0">
                        </div>
                         <div>
                            <label for="user-ideal-weight" class="block text-sm font-medium text-slate-700">Peso Ideal (kg):</label>
                            <input type="number" step="0.1" id="user-ideal-weight" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2" value="80.0">
                        </div>
                        <div>
                            <label for="user-email" class="block text-sm font-medium text-slate-700">Email:</label>
                            <input type="email" id="user-email" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2" value="ampaulo@example.com">
                        </div>
                        <div>
                            <label for="user-phone" class="block text-sm font-medium text-slate-700">Telefone:</label>
                            <input type="tel" id="user-phone" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2" value="(99) 99999-9999">
                        </div>
                    </div>
                    <button id="save-profile-btn" class="mt-8 w-full bg-teal-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-teal-700 transition">Salvar Meus Dados</button>
                </div>
            </div>

            <!-- View: Hoje -->
            <div id="hoje" class="view">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-teal-700" id="today-date"></h2>
                    <p class="text-slate-500 mt-1" id="today-motivation"></p>
                    <p class="text-slate-500 italic mt-1" id="today-verse"></p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Daily Schedule -->
                    <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">üóìÔ∏è Sua Rotina de Hoje</h3>
                        <ul id="today-schedule" class="space-y-3 text-slate-600">
                            <!-- JS will populate this -->
                        </ul>
                    </div>

                    <!-- Daily Tracking -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">üìù Registro Di√°rio</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="sleep-quality" class="block text-sm font-medium text-slate-700">Qualidade do Sono (1-5)</label>
                                <input type="number" min="1" max="5" id="sleep-quality" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2">
                            </div>
                             <div>
                                <label for="mood-rating" class="block text-sm font-medium text-slate-700">Humor (1-5)</label>
                                <input type="number" min="1" max="5" id="mood-rating" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2">
                            </div>
                             <div>
                                <label for="effort-level" class="block text-sm font-medium text-slate-700">N√≠vel de Esfor√ßo no Treino (1-5)</label>
                                <input type="number" min="1" max="5" id="effort-level" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2">
                            </div>
                             <div>
                                <label for="water-intake" class="block text-sm font-medium text-slate-700">Consumo de √Ågua (Litros)</label>
                                <input type="number" step="0.1" id="water-intake" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm p-2">
                            </div>
                            <button class="w-full bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-700 transition">Salvar Registro</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View: Amanh√£ -->
            <div id="amanha" class="view">
                <div class="text-center mb-8">
                    <h2 class="text-3xl font-bold text-teal-700" id="tomorrow-date"></h2>
                    <p class="text-slate-500 mt-1" id="tomorrow-motivation"></p>
                    <p class="text-slate-500 italic mt-1" id="tomorrow-verse"></p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Daily Schedule -->
                    <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">üóìÔ∏è Sua Rotina de Amanh√£</h3>
                        <ul id="tomorrow-schedule" class="space-y-3 text-slate-600">
                            <!-- JS will populate this -->
                        </ul>
                    </div>

                    <!-- Daily Tracking Placeholder -->
                    <div class="bg-white p-6 rounded-lg shadow-md flex items-center justify-center text-slate-500">
                        <p>Acompanhamento de amanh√£ dispon√≠vel amanh√£!</p>
                    </div>
                </div>
            </div>

            <!-- View: Plano de Treino -->
            <div id="treino" class="view">
                <!-- JS will populate this -->
            </div>

            <!-- View: Plano de Corrida -->
            <div id="corrida" class="view">
                 <!-- Sub-navigation for running plans -->
                <div class="flex flex-wrap justify-center items-center gap-2 py-2 mb-6 bg-white rounded-lg shadow-md">
                    <button data-target="corrida-ampaulo" class="sub-nav-button active text-sm font-medium py-2 px-4 rounded-full bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">üèÉ‚Äç‚ôÇÔ∏è Treino Ampaulo</button>
                    <button data-target="corrida-eloisa" class="sub-nav-button text-sm font-medium py-2 px-4 rounded-full bg-slate-200 text-slate-700 hover:bg-teal-500 hover:text-white">üèÉ‚Äç‚ôÄÔ∏è Treino Elo√≠sa</button>
                </div>

                <!-- Content for Ampaulo's Running Plan -->
                <div id="corrida-ampaulo" class="run-content-section active">
                    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">Defini√ß√µes de Ritmo de Corrida (Pace Zones) - Ampaulo</h3>
                        <div class="run-table-wrapper">
                            <table class="run-table w-full text-sm text-left border-collapse">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-2">Zona</th>
                                        <th class="px-4 py-2">Min/Km</th>
                                        <th class="px-4 py-2">Max/Km</th>
                                        <th class="px-4 py-2">Min Km/h</th>
                                        <th class="px-4 py-2">Max Km/h</th>
                                        <th class="px-4 py-2">Descri√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody id="pace-zones-ampaulo-body">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="space-y-8" id="treino-ampaulo-content">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Content for Elo√≠sa's Running Plan -->
                <div id="corrida-eloisa" class="run-content-section">
                    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                        <h3 class="text-xl font-bold text-slate-900 mb-4">Defini√ß√µes de Ritmo de Corrida (Pace Zones) - Elo√≠sa</h3>
                        <div class="run-table-wrapper">
                            <table class="run-table w-full text-sm text-left border-collapse">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-2">Zona</th>
                                        <th class="px-4 py-2">Min/Km</th>
                                        <th class="px-4 py-2">Max/Km</th>
                                        <th class="px-4 py-2">Min Km/h</th>
                                        <th class="px-4 py-2">Max Km/h</th>
                                        <th class="px-4 py-2">Descri√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody id="pace-zones-eloisa-body">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="space-y-8" id="treino-eloisa-content">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>

            <!-- View: Nutri√ß√£o -->
            <div id="nutricao" class="view">
                 <!-- JS will populate this -->
            </div>

            <!-- View: Progresso -->
            <div id="progresso" class="view">
                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4 text-center">üìä Acompanhamento do Progresso</h2>
                    <p class="text-slate-600 mb-6 text-center">Edite os dados diretamente na tabela abaixo. Clique em "Gerar Gr√°ficos" para visualizar suas mudan√ßas.</p>

                    <div class="overflow-x-auto mb-6">
                        <table id="progress-table" class="run-table w-full text-sm text-left border-collapse">
                            <thead>
                                <tr>
                                    <th class="px-4 py-2">Data</th>
                                    <th class="px-4 py-2">Peso (kg)</th>
                                    <th class="px-4 py-2">% Gordura</th>
                                    <th class="px-4 py-2">Massa G. (kg)</th>
                                    <th class="px-4 py-2">Massa L.G. (kg)</th>
                                    <th class="px-4 py-2">Cintura (cm)</th>
                                    <th class="px-4 py-2">Abd√¥men (cm)</th>
                                    <th class="px-4 py-2">Tricipital (mm)</th>
                                    <th class="px-4 py-2">Abdominal (mm)</th>
                                    <th class="px-4 py-2">Subescapular (mm)</th>
                                    <th class="px-4 py-2">Axilar M√©dia (mm)</th>
                                    <th class="px-4 py-2">Tor√°cica (mm)</th>
                                    <th class="px-4 py-2">Suprail√≠aca (mm)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be populated by JS -->
                            </tbody>
                        </table>
                    </div>

                    <div class="flex flex-wrap justify-center gap-4 mt-6">
                        <button id="add-progress-row-btn" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition">Adicionar Nova Entrada</button>
                        <button id="remove-progress-row-btn" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 transition">Remover √öltima Entrada</button>
                        <button id="generate-charts-btn" class="bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-700 transition">Gerar Gr√°ficos</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4 text-center">Peso e % de Gordura</h3>
                        <div class="chart-container">
                            <canvas id="weightFatChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4 text-center">Composi√ß√£o Corporal (Massa)</h3>
                         <div class="chart-container">
                            <canvas id="bodyCompositionChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4 text-center">Circunfer√™ncias (Cintura e Abd√¥men)</h3>
                         <div class="chart-container">
                            <canvas id="circumferenceChart"></canvas>
                        </div>
                    </div>
                     <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4 text-center">Evolu√ß√£o das Dobras Cut√¢neas</h3>
                         <div class="chart-container">
                            <canvas id="skinfoldChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View: Calend√°rio -->
            <div id="calendario" class="view">
                 <!-- JS will populate this -->
            </div>

            <!-- View: Finan√ßas -->
            <div id="financas" class="view">
                <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                    <h2 class="text-3xl font-bold text-teal-700 mb-4 text-center">üí∞ Suas Obriga√ß√µes Financeiras</h2>
                    <p class="text-slate-600 mb-6 text-center">Aqui voc√™ encontra os detalhes dos seus pagamentos e recebimentos mensais.</p>

                    <div class="space-y-8">
                        <div>
                            <h3 class="text-xl font-semibold mb-4 border-b pb-2">üí∏ Contas a Pagar Fixas Mensais (Vencimentos)</h3>
                            <div class="overflow-x-auto">
                                <table class="run-table w-full text-sm text-left border-collapse">
                                    <thead>
                                        <tr>
                                            <th class="px-4 py-2">Obriga√ß√£o</th>
                                            <th class="px-4 py-2">Dia do M√™s</th>
                                            <th class="px-4 py-2">Valor (R$)</th>
                                            <th class="px-4 py-2">Observa√ß√£o</th>
                                        </tr>
                                    </thead>
                                    <tbody id="fixed-payments-body">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-xl font-semibold mb-4 border-b pb-2">üí≥ Informa√ß√µes de Cart√£o de Cr√©dito</h3>
                            <div class="overflow-x-auto">
                                <table class="run-table w-full text-sm text-left border-collapse">
                                    <thead>
                                        <tr>
                                            <th class="px-4 py-2">Cart√£o</th>
                                            <th class="px-4 py-2">Dia de Vencimento</th>
                                            <th class="px-4 py-2">Dia de Fechamento</th>
                                        </tr>
                                    </thead>
                                    <tbody id="credit-card-info-body">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div>
                            <h3 class="text-xl font-semibold mb-4 border-b pb-2">üí∞ Recebimentos (Pr√≥ximos 12 Meses)</h3>
                            <div class="overflow-x-auto">
                                <table class="run-table w-full text-sm text-left border-collapse">
                                    <thead>
                                        <tr>
                                            <th class="px-4 py-2">M√™s/Ano</th>
                                            <th class="px-4 py-2">Sal√°rio (5¬∫ dia √∫til)</th>
                                            <th class="px-4 py-2">Adiantamento (Dia 20)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="salary-advance-body">
                                        <!-- Populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Modal for Calendar -->
    <div id="calendar-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center">
        <div class="bg-white rounded-lg shadow-xl p-6 m-4 max-w-lg w-full transform transition-all scale-95 opacity-0" id="modal-content">
            <h3 id="modal-title" class="text-xl font-bold text-teal-700"></h3>
            <p id="modal-activity" class="text-slate-600 mt-2"></p>
            <p id="modal-motivation" class="text-slate-500 mt-4"></p>
            <p id="modal-verse-ref" class="text-slate-500 italic mt-2"></p>
            <div id="modal-verse-text" class="text-slate-700 mt-2 text-sm hidden"> <!-- Hidden as per user request -->
                <div class="spinner mx-auto hidden"></div>
                <p id="verse-content"></p>
            </div>
            <div id="modal-finances" class="mt-4 pt-4 border-t border-slate-200">
                <h4 class="font-semibold text-slate-700 mb-2">Obriga√ß√µes Financeiras:</h4>
                <ul id="modal-finances-list" class="list-disc list-inside text-slate-600">
                    <!-- Finance details will be populated here -->
                </ul>
            </div>
            <button id="modal-close" class="mt-6 w-full bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-teal-700 transition">Fechar</button>
        </div>
    </div>

    <script>
        // --- APP LOGIC ---
        // Mapping for Bible book abbreviations for bibliaonline.com.br
        const bookAbbreviations = {
            "Prov√©rbios": "pv",
            "Salmos": "sl",
            "Romanos": "rm",
            "Filipenses": "fp",
            "Hebreus": "hb",
            "Josu√©": "js",
            "1 Cor√≠ntios": "1co",
            "G√°latas": "gl",
            "Mateus": "mt",
            "2 Tim√≥teo": "2tm",
            "Colossenses": "cl",
            "Lucas": "lc",
            "1 Tessalonicenses": "1ts",
            "1 Pedro": "1pe",
            "Isa√≠as": "is",
            "Ef√©sios": "ef",
            "Tiago": "tg",
            "Jo√£o": "jo",
            // Add more as needed
        };

        // Function to fetch Bible verse text (kept for reference, but not used in modal display)
        async function getBibleVerseText(verseReference) {
            if (!verseReference) return null;

            const parts = verseReference.match(/(\d?\s?[A-Za-z√Ä-√ñ√ò-√∂√∏-√ø]+)\s(\d+):(\d+)/);
            if (!parts) {
                console.warn("Formato de vers√≠culo inv√°lido:", verseReference);
                return null;
            }

            let bookName = parts[1].trim();
            const chapter = parts[2];
            const verse = parts[3];

            // Handle "1 Cor√≠ntios" -> "1co", "2 Tim√≥teo" -> "2tm" etc.
            if (bookName.startsWith("1 ") || bookName.startsWith("2 ") || bookName.startsWith("3 ")) {
                const num = bookName.substring(0, 1);
                const baseName = bookName.substring(2).trim();
                const abbrev = bookAbbreviations[baseName];
                if (abbrev) {
                    bookName = num + abbrev;
                } else {
                    console.warn(`Abrevia√ß√£o n√£o encontrada para o livro: ${baseName}`);
                    return null;
                }
            } else {
                bookName = bookAbbreviations[bookName];
                if (!bookName) {
                    console.warn(`Abrevia√ß√£o n√£o encontrada para o livro: ${parts[1].trim()}`);
                    return null;
                }
            }


            const url = `https://www.bibliaonline.com.br/acf/${bookName}/${chapter}/${verse}`;
            console.log("Fetching Bible verse from:", url);

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const html = await response.text();

                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // The verse text is typically within a p tag with class "version-text"
                const verseElement = doc.querySelector('p.version-text');
                if (verseElement) {
                    // Remove any child elements like <sup> for verse numbers
                    Array.from(verseElement.children).forEach(child => child.remove());
                    return verseElement.textContent.trim();
                } else {
                    console.warn("Elemento do vers√≠culo n√£o encontrado na p√°gina:", url);
                    return "Vers√≠culo n√£o encontrado ou erro ao carregar.";
                }
            } catch (error) {
                console.error("Erro ao buscar o vers√≠culo da B√≠blia:", error);
                return "Erro ao carregar o vers√≠culo.";
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Content Loaded!'); // Log para depura√ß√£o
            const views = document.querySelectorAll('.view');
            const navButtons = document.querySelectorAll('.nav-button');

            // --- Navigation ---
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.dataset.target;
                    console.log(`Navigating to: ${targetId} view`); // Log para depura√ß√£o

                    navButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    views.forEach(view => {
                        view.classList.remove('active');
                        if (view.id === targetId) {
                            view.classList.add('active');
                        }
                    });

                    // Lazy load charts only if progresso is clicked and charts haven't been initialized
                    if(targetId === 'progresso' && !document.getElementById('weightFatChart').__chartjs__) {
                        initCharts();
                    }
                    if (targetId === 'home') {
                        populateUserProfileForm();
                    }
                });
            });

            // --- Initial Load ---
            // Firebase will trigger loading of user profile and progress data
            // once authenticated, which will then trigger rendering functions.
            document.addEventListener('firebaseAuthReady', () => {
                console.log('Firebase Auth Ready. Initializing views...'); // Log para depura√ß√£o
                initHomeView(); // Initialize Home view after profile load
                initTodayView();
                initTomorrowView(); // Initialize Tomorrow view
                initWorkoutsView();
                initRunsView(); // This will now handle sub-navigation
                initNutritionView();
                initCalendarView();
                initFinancesView(); // Initialize the new Finances view
                renderProgressTable(); // Render table initially with default/loaded data
            });


            // --- Accordion Logic ---
            document.body.addEventListener('click', function(e) {
                if (e.target.matches('.workout-accordion-button') || e.target.closest('.workout-accordion-button')) {
                    const button = e.target.matches('.workout-accordion-button') ? e.target : e.target.closest('.workout-accordion-button');
                    button.classList.toggle('open');
                } else if (e.target.matches('.group-accordion-button') || e.target.closest('.group-accordion-button')) {
                    const button = e.target.matches('.group-accordion-button') ? e.target : e.target.closest('.group-accordion-button');
                    button.classList.toggle('open');
                }
            });

            // --- Calendar Modal Logic ---
            const calendarModal = document.getElementById('calendar-modal');
            const calendarModalContent = document.getElementById('modal-content');
            const calendarModalClose = document.getElementById('modal-close');
            const modalVerseRef = document.getElementById('modal-verse-ref');
            const modalVerseText = document.getElementById('modal-verse-text');
            const verseContent = document.getElementById('verse-content');
            const verseSpinner = modalVerseText.querySelector('.spinner');


            document.body.addEventListener('click', async function(e) { // Made async to await getBibleVerseText
                 if (e.target.matches('.calendar-day')) {
                    const dayData = window.projectData.calendar[parseInt(e.target.dataset.day) - 1];
                    document.getElementById('modal-title').textContent = `${e.target.dataset.day} de Julho, ${dayData.weekday}`; // Updated month
                    document.getElementById('modal-activity').innerHTML = `Atividade: ${dayData.activity}`; // Use innerHTML for <br>
                    document.getElementById('modal-motivation').textContent = dayData.msg ? `"${dayData.msg}"` : "";

                    // Display verse reference, but do not fetch or display full text
                    modalVerseRef.textContent = dayData.verse ? `"${dayData.verse}"` : "";
                    verseContent.textContent = ""; // Clear any previous verse content
                    verseSpinner.classList.add('hidden'); // Ensure spinner is hidden
                    modalVerseText.classList.add('hidden'); // Ensure the text container is hidden

                    // Populate financial obligations for the day
                    const financeList = document.getElementById('modal-finances-list');
                    financeList.innerHTML = '';
                    const currentDay = parseInt(e.target.dataset.day);
                    const currentMonth = new Date().getMonth(); // July is 6
                    const currentYear = new Date().getFullYear(); // 2025

                    const todayDate = new Date(currentYear, currentMonth, currentDay);

                    const obligationsToday = window.projectData.finances.billPayments.filter(bill => bill.day === currentDay);
                    if (obligationsToday.length > 0) {
                        obligationsToday.forEach(bill => {
                            const li = document.createElement('li');
                            li.textContent = `${bill.name} (Vencimento)`;
                            financeList.appendChild(li);
                        });
                    }

                    // Check for salary and advance payment
                    const salaryDate = getNthBusinessDay(currentYear, currentMonth, window.projectData.finances.salaryDetails.salaryDay, true); // 5th business day, including Saturday
                    if (salaryDate && salaryDate.getDate() === currentDay) {
                        const li = document.createElement('li');
                        li.textContent = `Recebimento de Sal√°rio!`;
                        financeList.appendChild(li);
                    }

                    const advancePaymentDate = getNextBusinessDay(new Date(currentYear, currentMonth, window.projectData.finances.salaryDetails.advanceDay));
                    if (advancePaymentDate && advancePaymentDate.getDate() === currentDay) {
                        const li = document.createElement('li');
                        li.textContent = `Recebimento de Adiantamento!`;
                        financeList.appendChild(li);
                    }

                    if (financeList.children.length === 0) {
                        const li = document.createElement('li');
                        li.textContent = 'Nenhuma obriga√ß√£o financeira para este dia.';
                        financeList.appendChild(li);
                    }


                    calendarModal.classList.remove('hidden');
                    calendarModal.classList.add('flex');
                    setTimeout(() => {
                       calendarModalContent.classList.remove('scale-95', 'opacity-0');
                    }, 10);
                }
            });

            const closeCalendarModal = () => {
                calendarModalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    calendarModal.classList.add('hidden');
                    calendarModal.classList.remove('flex');
                }, 200);
            };

            calendarModalClose.addEventListener('click', closeCalendarModal);
            calendarModal.addEventListener('click', (e) => {
                if (e.target === calendarModal) {
                    closeCalendarModal();
                }
            });

            // --- Home View Event Listeners ---
            document.getElementById('save-profile-btn').addEventListener('click', () => {
                window.userProfile.name = document.getElementById('user-name').value;
                window.userProfile.gender = document.getElementById('user-gender').value;
                window.userProfile.dob = document.getElementById('user-dob').value;
                window.userProfile.height = parseFloat(document.getElementById('user-height').value);
                window.userProfile.currentWeight = parseFloat(document.getElementById('user-current-weight').value);
                window.userProfile.idealWeight = parseFloat(document.getElementById('user-ideal-weight').value);
                window.userProfile.email = document.getElementById('user-email').value;
                window.userProfile.phone = document.getElementById('user-phone').value;
                window.saveUserProfileToFirestore();
            });

            // --- Progress View Event Listeners ---
            document.getElementById('add-progress-row-btn').addEventListener('click', addProgressRow);
            document.getElementById('remove-progress-row-btn').addEventListener('click', removeProgressRow);
            document.getElementById('generate-charts-btn').addEventListener('click', initCharts);

        });

        // Function to populate user profile form from window.userProfile
        function populateUserProfileForm() {
            try {
                document.getElementById('user-name').value = window.userProfile.name;
                document.getElementById('user-gender').value = window.userProfile.gender;
                document.getElementById('user-dob').value = window.userProfile.dob;
                document.getElementById('user-height').value = window.userProfile.height;
                document.getElementById('user-current-weight').value = window.userProfile.currentWeight;
                window.userProfile.idealWeight = parseFloat(document.getElementById('user-ideal-weight').value);
                document.getElementById('user-email').value = window.userProfile.email;
                document.getElementById('user-phone').value = window.userProfile.phone;
                console.log("Perfil do usu√°rio populado no formul√°rio."); // Log para depura√ß√£o
            } catch (e) {
                console.error("Erro ao popular formul√°rio de perfil do usu√°rio:", e);
            }
        }

        // --- View Initialization Functions ---

        function initHomeView() {
            console.log('Initializing Home View...'); // Log para depura√ß√£o
            populateUserProfileForm();
        }

        function initTodayView() {
            console.log('Initializing Today View...'); // Log para depura√ß√£o
            try {
                const today = new Date(); // Get current date
                const dayOfMonth = today.getDate();
                const weekdayIndex = today.getDay(); // 0 for Sunday, 1 for Monday...

                const weekdays = ["Domingo", "Segunda-feira", "Ter√ßa-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "S√°bado"];
                const weekdayName = weekdays[weekdayIndex];

                document.getElementById('today-date').textContent = `${weekdayName}, ${dayOfMonth} de Julho`;

                const todayData = window.projectData.calendar.find(d => d.day === dayOfMonth); // Find based on day
                document.getElementById('today-motivation').textContent = todayData ? (todayData.msg || "Mantenha o foco e a disciplina.") : "Mantenha o foco e a disciplina.";
                document.getElementById('today-verse').textContent = todayData && todayData.verse ? `"${todayData.verse}"` : "";

                const todayScheduleData = window.projectData.weeklySchedule.find(d => d.day === weekdayName);
                const scheduleList = document.getElementById('today-schedule');
                scheduleList.innerHTML = '';
                if (todayScheduleData && todayScheduleData.schedule.length > 0) {
                     todayScheduleData.schedule.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'flex items-center gap-4';
                        li.innerHTML = `<span class="bg-teal-100 text-teal-700 text-xs font-semibold px-2.5 py-0.5 rounded-full">${item.time}</span><span>${item.task}</span>`;
                        scheduleList.appendChild(li);
                    });
                } else {
                    scheduleList.innerHTML = '<li>Dia de descanso ou atividades flex√≠veis. Aproveite!</li>';
                }

                // Add financial obligations to Today's schedule
                const currentMonth = today.getMonth();
                const currentYear = today.getFullYear();

                const obligationsToday = window.projectData.finances.billPayments.filter(bill => bill.day === dayOfMonth);
                if (obligationsToday.length > 0) {
                    const liHeader = document.createElement('li');
                    liHeader.className = 'font-bold text-red-700 mt-4';
                    liHeader.textContent = 'üö® Obriga√ß√µes Financeiras:';
                    scheduleList.appendChild(liHeader);
                    obligationsToday.forEach(bill => {
                        const li = document.createElement('li');
                        li.className = 'flex items-center gap-4 text-red-600';
                        li.innerHTML = `<span class="bg-red-100 text-red-700 text-xs font-semibold px-2.5 py-0.5 rounded-full">Dia ${bill.day}</span><span>${bill.name} (Vencimento)</span>`;
                        scheduleList.appendChild(li);
                    });
                }

                const salaryDate = getNthBusinessDay(currentYear, currentMonth, window.projectData.finances.salaryDetails.salaryDay, true);
                if (salaryDate && salaryDate.getDate() === dayOfMonth) {
                    const li = document.createElement('li');
                    li.className = 'flex items-center gap-4 text-green-700 font-semibold mt-2';
                    li.innerHTML = `<span class="bg-green-100 text-green-700 text-xs font-semibold px-2.5 py-0.5 rounded-full">Recebimento</span><span>üí∞ Sal√°rio!</span>`;
                    scheduleList.appendChild(li);
                }

                const advancePaymentDate = getNextBusinessDay(new Date(currentYear, currentMonth, window.projectData.finances.salaryDetails.advanceDay));
                if (advancePaymentDate && advancePaymentDate.getDate() === dayOfMonth) {
                    const li = document.createElement('li');
                    li.className = 'flex items-center gap-4 text-green-700 font-semibold mt-2';
                    li.innerHTML = `<span class="bg-green-100 text-green-700 text-xs font-semibold px-2.5 py-0.5 rounded-full">Recebimento</span><span>üíµ Adiantamento!</span>`;
                    scheduleList.appendChild(li);
                }

            } catch (e) {
                console.error("Erro ao inicializar a vista 'Hoje':", e);
            }
        }

        function initTomorrowView() {
            console.log('Initializing Tomorrow View...'); // Log para depura√ß√£o
            try {
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1); // Get tomorrow's date
                const dayOfMonth = tomorrow.getDate();
                const weekdayIndex = tomorrow.getDay();

                const weekdays = ["Domingo", "Segunda-feira", "Ter√ßa-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "S√°bado"];
                const weekdayName = weekdays[weekdayIndex];

                document.getElementById('tomorrow-date').textContent = `${weekdayName}, ${dayOfMonth} de Julho`;

                const tomorrowData = window.projectData.calendar.find(d => d.day === dayOfMonth); // Find based on day
                document.getElementById('tomorrow-motivation').textContent = tomorrowData ? (tomorrowData.msg || "Prepare-se para mais um dia de sucesso!") : "Prepare-se para mais um dia de sucesso!";
                document.getElementById('tomorrow-verse').textContent = tomorrowData && tomorrowData.verse ? `"${tomorrowData.verse}"` : "";

                const tomorrowScheduleData = window.projectData.weeklySchedule.find(d => d.day === weekdayName);
                const scheduleList = document.getElementById('tomorrow-schedule');
                scheduleList.innerHTML = '';
                if (tomorrowScheduleData && tomorrowScheduleData.schedule.length > 0) {
                     tomorrowScheduleData.schedule.forEach(item => {
                        const li = document.createElement('li');
                        li.className = 'flex items-center gap-4';
                        li.innerHTML = `<span class="bg-teal-100 text-teal-700 text-xs font-semibold px-2.5 py-0.5 rounded-full">${item.time}</span><span>${item.task}</span>`;
                        scheduleList.appendChild(li);
                    });
                } else {
                    scheduleList.innerHTML = '<li>Dia de descanso ou atividades flex√≠veis. Aproveite!</li>';
                }

                // Add financial obligations to Tomorrow's schedule
                const currentMonth = tomorrow.getMonth();
                const currentYear = tomorrow.getFullYear();

                const obligationsTomorrow = window.projectData.finances.billPayments.filter(bill => bill.day === dayOfMonth);
                if (obligationsTomorrow.length > 0) {
                    const liHeader = document.createElement('li');
                    liHeader.className = 'font-bold text-red-700 mt-4';
                    liHeader.textContent = 'üö® Obriga√ß√µes Financeiras:';
                    scheduleList.appendChild(liHeader);
                    obligationsTomorrow.forEach(bill => {
                        const li = document.createElement('li');
                        li.className = 'flex items-center gap-4 text-red-600';
                        li.innerHTML = `<span class="bg-red-100 text-red-700 text-xs font-semibold px-2.5 py-0.5 rounded-full">Dia ${bill.day}</span><span>${bill.name} (Vencimento)</span>`;
                        scheduleList.appendChild(li);
                    });
                }

                const salaryDate = getNthBusinessDay(currentYear, currentMonth, window.projectData.finances.salaryDetails.salaryDay, true);
                if (salaryDate && salaryDate.getDate() === dayOfMonth) {
                    const li = document.createElement('li');
                    li.className = 'flex items-center gap-4 text-green-700 font-semibold mt-2';
                    li.innerHTML = `<span class="bg-green-100 text-green-700 text-xs font-semibold px-2.5 py-0.5 rounded-full">Recebimento</span><span>üí∞ Sal√°rio!</span>`;
                    scheduleList.appendChild(li);
                }

                const advancePaymentDate = getNextBusinessDay(new Date(currentYear, currentMonth, window.projectData.finances.salaryDetails.advanceDay));
                if (advancePaymentDate && advancePaymentDate.getDate() === dayOfMonth) {
                    const li = document.createElement('li');
                    li.className = 'flex items-center gap-4 text-green-700 font-semibold mt-2';
                    li.innerHTML = `<span class="bg-green-100 text-green-700 text-xs font-semibold px-2.5 py-0.5 rounded-full">Recebimento</span><span>üíµ Adiantamento!</span>`;
                    scheduleList.appendChild(li);
                }

            } catch (e) {
                console.error("Erro ao inicializar a vista 'Amanh√£':", e);
            }
        }

        function initWorkoutsView() {
            console.log('Initializing Workouts View...'); // Log para depura√ß√£o
            const container = document.getElementById('treino');
            if (!container) {
                console.error("Container #treino n√£o encontrado!");
                return;
            }

            container.innerHTML = `
                <div class="space-y-6">
                    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
                        <h2 class="text-2xl font-bold text-teal-700 mb-4 text-center">üèãÔ∏è‚Äç‚ôÇÔ∏è Resumo de S√©ries Semanais ‚Äì Projeto Ampaulo</h2>
                        <div class="overflow-x-auto mb-6">
                            <h3 class="text-xl font-semibold mb-2">‚úÖ S√âRIES POR DIA (Atualizado e Otimizado)</h3>
                            <table class="run-table w-full text-sm text-left border-collapse">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-2">üìÖ Dia</th>
                                        <th class="px-4 py-2">üí™ Treino</th>
                                        <th class="px-4 py-2">üî¢ S√©ries Detalhadas</th>
                                        <th class="px-4 py-2">üìä Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="px-4 py-2">Quarta</td>
                                        <td class="px-4 py-2">Inferiores B</td>
                                        <td class="px-4 py-2">12 (Quadr√≠ceps) + 12 (Core/Abd√¥men) + 4 (Lombar)</td>
                                        <td class="px-4 py-2">28 s√©ries</td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2">Sexta</td>
                                        <td class="px-4 py-2">Peito + Tr√≠ceps</td>
                                        <td class="px-4 py-2">18 (Peitoral) + 9 (Tr√≠ceps)</td>
                                        <td class="px-4 py-2">27 s√©ries</td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2">S√°bado</td>
                                        <td class="px-4 py-2">Ombros + Trap√©zio</td>
                                        <td class="px-4 py-2">18 (Ombros) + 9 (Trap√©zio)</td>
                                        <td class="px-4 py-2">27 s√©ries</td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2">Domingo</td>
                                        <td class="px-4 py-2">Inferiores A</td>
                                        <td class="px-4 py-2">6 (Gl√∫teos) + 6 (Posterior de Coxa) + 6 (Panturrilhas) + 12 (Core/Abd√¥men)</td>
                                        <td class="px-4 py-2">30 s√©ries</td>
                                    </tr>
                                    <tr>
                                        <td class="px-4 py-2">Segunda</td>
                                        <td class="px-4 py-2">Costas + Antebra√ßo + B√≠ceps</td>
                                        <td class="px-4 py-2">20 (Costas) + 4 (Antebra√ßo) + 6 (B√≠ceps)</td>
                                        <td class="px-4 py-2">30 s√©ries</td>
                                    </tr>
                                    <tr class="font-bold bg-slate-100">
                                        <td class="px-4 py-2" colspan="3">üßÆ TOTAL SEMANAL DE S√âRIES DE MUSCULA√á√ÉO</td>
                                        <td class="px-4 py-2">üü© 142 s√©ries por semana</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="overflow-x-auto">
                            <h3 class="text-xl font-semibold mb-2">‚úÖ Distribui√ß√£o por Grupo Muscular (Total Semanal)</h3>
                            <table class="run-table w-full text-sm text-left border-collapse">
                                <thead>
                                    <tr>
                                        <th class="px-4 py-2">üí• Grupo Muscular</th>
                                        <th class="px-4 py-2">üî¢ S√©ries Semanais</th>
                                        <th class="px-4 py-2">üß† Observa√ß√£o T√©cnica</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td class="px-4 py-2">Quadr√≠ceps</td><td class="px-4 py-2">12 s√©ries</td><td class="px-4 py-2">Excelente para volume, foco na frente da coxa.</td></tr>
                                    <tr><td class="px-4 py-2">Posterior de Coxa</td><td class="px-4 py-2">6 s√©ries</td><td class="px-4 py-2">Mant√©m equil√≠brio funcional com o quadr√≠ceps.</td></tr>
                                    <tr><td class="px-4 py-2">Gl√∫teos</td><td class="px-4 py-2">6 s√©ries</td><td class="px-4 py-2">Hip Thrust + Terra garantem ativa√ß√£o completa.</td></tr>
                                    <tr><td class="px-4 py-2">Panturrilhas</td><td class="px-4 py-2">6 s√©ries</td><td class="px-4 py-2">Frequ√™ncia ideal, com est√≠mulo direto e variado.</td></tr>
                                    <tr><td class="px-4 py-2">Core/Abd√¥men</td><td class="px-4 py-2">24 s√©ries (12 + 12)</td><td class="px-4 py-2">Volume elevado para performance na corrida.</td></tr>
                                    <tr><td class="px-4 py-2">Lombar</td><td class="px-4 py-2">4 s√©ries</td><td class="px-4 py-2">Essencial para prote√ß√£o de coluna e postura.</td></tr>
                                    <tr><td class="px-4 py-2">Peitoral</td><td class="px-4 py-2">18 s√©ries</td><td class="px-4 py-2">Alta efici√™ncia com volume adequado.</td></tr>
                                    <tr><td class="px-4 py-2">Tr√≠ceps</td><td class="px-4 py-2">9 s√©ries</td><td class="px-4 py-2">Equilibrado com o peitoral.</td></tr>
                                    <tr><td class="px-4 py-2">Ombros</td><td class="px-4 py-2">18 s√©ries</td><td class="px-4 py-2">Foco em deltoides anterior, medial e posterior.</td></tr>
                                    <tr><td class="px-4 py-2">Trap√©zio</td><td class="px-4 py-2">9 s√©ries</td><td class="px-4 py-2">Equilibrado, com varia√ß√£o de cargas e movimentos.</td></tr>
                                    <tr><td class="px-4 py-2">Costas</td><td class="px-4 py-2">20 s√©ries</td><td class="px-4 py-2">Volume ideal para for√ßa, amplitude e largura.</td></tr>
                                    <tr><td class="px-4 py-2">Antebra√ßo</td><td class="px-4 py-2">4 s√©ries</td><td class="px-4 py-2">Suporte funcional para pegadas e resist√™ncia.</td></tr>
                                    <tr><td class="px-4 py-2">B√≠ceps</td><td class="px-4 py-2">6 s√©ries</td><td class="px-4 py-2">Boa estimula√ß√£o, alinhado ao trabalho de costas.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            const workoutContainer = container.querySelector('.space-y-6');
            if (!workoutContainer) {
                console.error("workoutContainer n√£o encontrado!");
                return;
            }

            try {
                // Add individual workout details below the summary tables
                // Ensure the order matches the desired display order (Quarta, Sexta, S√°bado, Domingo, Segunda)
                const workoutOrder = ['quarta_inferiores_b', 'sexta_peito_triceps', 'sabado_ombros_trapezio', 'domingo_inferiores_a', 'segunda_costas_antebraco_biceps'];

                workoutOrder.forEach(key => {
                    const workout = window.projectData.workouts[key];
                    if (!workout) return; // Skip if workout not found (shouldn't happen with fixed keys)

                    const workoutHTML = `
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <button class="workout-accordion-button w-full text-left">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-xl font-bold text-slate-900">${workout.title} <span class="text-sm font-normal text-slate-500">(${workout.series} s√©ries)</span></h3>
                                    <span class="text-teal-500 transform transition-transform">‚ñº</span>
                                </div>
                                <p class="text-slate-500 mt-1">${workout.objective}</p>
                            </button>
                            <div class="workout-accordion-content mt-4 border-t pt-4">
                                ${workout.groups.map(group => `
                                    <div class="mb-4">
                                        <button class="group-accordion-button w-full text-left flex justify-between items-center">
                                            <h4 class="font-semibold text-lg text-teal-700">${group.name} <span class="text-sm font-normal text-slate-500">(${group.series} s√©ries)</span></h4>
                                            <span class="text-teal-400 transform transition-transform">‚ñ∂</span>
                                        </button>
                                        <div class="group-accordion-content mt-2">
                                            <ul class="space-y-3">
                                                ${group.exercises.map(ex => `
                                                    <li class="p-3 bg-slate-50 rounded-md">
                                                        <p class="font-semibold">${ex.name} <span class="font-normal text-slate-500">- ${ex.sets}</span></p>
                                                        <p class="text-sm text-slate-600 mt-1">${ex.howto}</p>
                                                    </li>
                                                `).join('')}
                                            </ul>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    workoutContainer.innerHTML += workoutHTML;
                });
            } catch (e) {
                console.error("Erro ao renderizar HTML dos treinos:", e);
            }
        }

        function initRunsView() {
            console.log('Initializing Runs View...'); // Log para depura√ß√£o
            const container = document.getElementById('corrida');
            if (!container) {
                console.error("Container #corrida n√£o encontrado!");
                return;
            }

            // Function to render pace zones table
            const renderPaceZonesTable = (targetBodyId, paceData) => {
                const tableBody = document.getElementById(targetBodyId);
                if (!tableBody) {
                    console.error(`Table body ${targetBodyId} not found!`);
                    return '';
                }
                tableBody.innerHTML = paceData.map(zone => `
                    <tr class="border-b border-gray-200">
                        <td class="px-4 py-2"><strong>${zone.name}</strong></td>
                        <td class="px-4 py-2">${zone.min_km}</td>
                        <td class="px-4 py-2">${zone.max_km}</td>
                        <td class="px-4 py-2">${zone.min_kmh}</td>
                        <td class="px-4 py-2">${zone.max_kmh}</td>
                        <td class="px-4 py-2">${zone.description}</td>
                    </tr>
                `).join('');
            };

            // Function to render running workouts
            const renderRunningWorkouts = (targetContentId, workouts, isAmpaulo) => {
                const contentDiv = document.getElementById(targetContentId);
                if (!contentDiv) {
                    console.error(`Content div ${targetContentId} not found!`);
                    return '';
                }
                contentDiv.innerHTML = workouts.map(key => {
                    const run = window.projectData.runs[key];
                    if (!run) return '';

                    let tableHeaders = '';
                    let tableRows = '';

                    if (isAmpaulo) {
                        tableHeaders = `
                            <tr>
                                <th class="px-4 py-2">Km</th>
                                <th class="px-4 py-2">Etapa</th>
                                <th class="px-4 py-2">Pace Alvo</th>
                                <th class="px-4 py-2">Zona</th>
                                <th class="px-4 py-2">Tempo Estimado</th>
                                <th class="px-4 py-2">Observa√ß√µes</th>
                            </tr>
                        `;
                        tableRows = run.stages.map(stage => `
                            <tr class="border-b border-gray-200">
                                <td class="px-4 py-2 font-medium">${stage.km}</td>
                                <td class="px-4 py-2">${stage.name}</td>
                                <td class="px-4 py-2">${stage.pace}</td>
                                <td class="px-4 py-2">${stage.zone}</td>
                                <td class="px-4 py-2">${stage.estimated_time}</td>
                                <td class="px-4 py-2">${stage.observations}</td>
                            </tr>
                        `).join('');
                    } else {
                        tableHeaders = `
                            <tr>
                                <th class="px-4 py-2">Etapa</th>
                                <th class="px-4 py-2">Dura√ß√£o</th>
                                <th class="px-4 py-2">Ritmo</th>
                            </tr>
                        `;
                        tableRows = run.stages.map(stage => `
                            <tr class="border-b border-gray-200">
                                <td class="px-4 py-2 font-medium">${stage.name}</td>
                                <td class="px-4 py-2">${stage.duration}</td>
                                <td class="px-4 py-2">${stage.pace}</td>
                            </tr>
                        `).join('');
                    }

                    return `
                        <div class="bg-slate-50 p-6 rounded-lg shadow-md flex flex-col">
                            <h3 class="text-xl font-bold text-slate-900 mb-4">${run.title}</h3>
                            ${isAmpaulo ? `<p class="text-slate-600 mb-2"><strong>Hor√°rio:</strong> ${run.schedule}</p>` : ''}
                            ${isAmpaulo ? `<p class="text-slate-600 mb-2"><strong>Objetivo:</strong> ${run.objective}</p>` : ''}
                            ${isAmpaulo ? `<p class="text-slate-600 mb-4"><strong>Dist√¢ncia Estimada:</strong> ${run.estimated_distance}</p>` : ''}
                            <div class="overflow-x-auto flex-grow">
                                <table class="run-table w-full text-sm text-left">
                                    <thead class="bg-slate-100">
                                        ${tableHeaders}
                                    </thead>
                                    <tbody>
                                        ${tableRows}
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-4 pt-4 border-t flex justify-between font-semibold">
                                <span>Total:</span>
                                <span>${run.total.duration} / ~${run.total.distance}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            };

            // Initial rendering for Ampaulo's content
            renderPaceZonesTable('pace-zones-ampaulo-body', window.projectData.runs.paceDefinitionsAmpaulo);
            // Changed the layout for Ampaulo's workouts from grid to stacked
            document.getElementById('treino-ampaulo-content').classList.remove('grid', 'grid-cols-1', 'md:grid-cols-2', 'lg:grid-cols-3', 'gap-6');
            document.getElementById('treino-ampaulo-content').classList.add('space-y-8');
            renderRunningWorkouts('treino-ampaulo-content', ['leve', 'intervalada', 'longa'], true); // Pass true for Ampaulo

            // Initial rendering for Elo√≠sa's content (hidden by default)
            renderPaceZonesTable('pace-zones-eloisa-body', window.projectData.runs.paceDefinitionsEloisa);
            // Change Elo√≠sa's layout to be stacked
            document.getElementById('treino-eloisa-content').classList.remove('grid', 'grid-cols-1', 'md:grid-cols-2', 'lg:grid-cols-3', 'gap-6');
            document.getElementById('treino-eloisa-content').classList.add('space-y-8');
            renderRunningWorkouts('treino-eloisa-content', ['segunda_eloisa', 'quarta_eloisa', 'sabado_eloisa'], false); // Pass false for Elo√≠sa


            // Sub-navigation logic
            const subNavButtons = container.querySelectorAll('.sub-nav-button');
            const runContentSections = container.querySelectorAll('.run-content-section');

            subNavButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetId = button.dataset.target;

                    subNavButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');

                    runContentSections.forEach(section => {
                        section.classList.remove('active');
                        if (section.id === targetId) {
                            section.classList.add('active');
                        }
                    });
                });
            });
        }

        function initNutritionView() {
            console.log('Initializing Nutrition View...'); // Log para depura√ß√£o
            const container = document.getElementById('nutricao');
            if (!container) {
                console.error("Container #nutricao n√£o encontrado!");
                return;
            }
            const data = window.projectData.nutrition;
            try {
                container.innerHTML = `
                     <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-bold text-slate-900 mb-4">Plano Alimentar Di√°rio</h3>
                            <div class="space-y-4">
                                ${data.meals.map((meal, index) => `
                                    <div class="p-4 bg-slate-50 rounded-md">
                                        <h4 class="font-semibold text-teal-700">${meal.name}</h4>
                                        <p class="text-slate-600">${meal.items}</p>
                                    </div>
                                `).join('')}
                            </div>
                             <div class="mt-6">
                                <h3 class="text-xl font-bold text-slate-900 mb-4">An√°lise de Macronutrientes (Aprox.)</h3>
                                 <div class="overflow-x-auto">
                                     <table class="run-table w-full text-sm text-left border-collapse">
                                         <thead>
                                            <tr>
                                                <th class="px-4 py-2">Refei√ß√£o</th>
                                                <th class="px-4 py-2">Prote√≠nas (g)</th>
                                                <th class="px-4 py-2">Carboidratos (g)</th>
                                                <th class="px-4 py-2">Gorduras (g)</th>
                                                <th class="px-4 py-2">Kcal</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${data.macros.map(macro => `
                                                <tr class="border-b border-gray-200">
                                                    <td class="px-4 py-2 font-medium">${macro.meal}</td>
                                                    <td class="px-4 py-2">${macro.protein}</td>
                                                    <td class="px-4 py-2">${macro.carbs}</td>
                                                    <td class="px-4 py-2">${macro.fat}</td>
                                                    <td class="px-4 py-2">${macro.kcal}</td>
                                                </tr>
                                            `).join('')}
                                            <tr class="font-bold bg-slate-50">
                                                 <td class="px-4 py-2">Total Di√°rio</td>
                                                 <td class="px-4 py-2">${data.total.protein}</td>
                                                 <td class="px-4 py-2">${data.total.carbs}</td>
                                                 <td class="px-4 py-2">${data.total.fat}</td>
                                                 <td class="px-4 py-2">${data.total.kcal}</td>
                                            </tr>
                                        </tbody>
                                     </table>
                                </div>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                 <h3 class="text-xl font-bold text-slate-900 mb-2">${data.isotonic.title}</h3>
                                 <p class="text-slate-600">${data.isotonic.recipe}</p>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                 <h3 class="text-xl font-bold text-slate-900 mb-2">Refor√ßo Imunol√≥gico Natural no Inverno</h3>
                                 ${data.naturalImmunity.sections.map(section => `
                                    <h4 class="font-semibold text-teal-700 mt-4">${section.heading}</h4>
                                    <ul class="list-disc list-inside text-slate-600 space-y-1">
                                        ${section.items.map(item => `<li>${item}</li>`).join('')}
                                    </ul>
                                 `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            } catch (e) {
                console.error("Erro ao inicializar a vista 'Nutri√ß√£o':", e);
            }
        }

        function renderProgressTable() {
            console.log('Rendering Progress Table...'); // Log para depura√ß√£o
            const tableBody = document.getElementById('progress-table').querySelector('tbody');
            if (!tableBody) {
                console.error("Table body for progress table not found!");
                return;
            }
            tableBody.innerHTML = ''; // Clear existing rows

            const pData = window.projectData.progress;
            const numEntries = pData.dates.length;

            try {
                for (let i = 0; i < numEntries; i++) {
                    const row = tableBody.insertRow();
                    row.insertCell().textContent = pData.dates[i]; // Date is not editable for simplicity
                    const editableCells = ['weight', 'fatPercentage', 'fatMass', 'leanMass', 'waist', 'abdomen'];
                    editableCells.forEach(key => {
                        const cell = row.insertCell();
                        cell.contentEditable = "true";
                        cell.dataset.key = key;
                        cell.dataset.index = i;
                        cell.textContent = pData[key][i];
                        cell.addEventListener('input', handleProgressCellEdit);
                        cell.addEventListener('blur', handleProgressCellBlur); // Save on blur
                    });

                    // Skinfolds are an array of arrays, handled differently
                    pData.skinfolds.labels.forEach((label, skinfoldIndex) => {
                        const cell = row.insertCell();
                        cell.contentEditable = "true";
                        cell.dataset.key = 'skinfolds';
                        cell.dataset.skinfoldIndex = skinfoldIndex;
                        cell.dataset.index = i;
                        cell.textContent = pData.skinfolds.data[i][skinfoldIndex];
                        cell.addEventListener('input', handleProgressCellEdit);
                        cell.addEventListener('blur', handleProgressCellBlur); // Save on blur
                    });
                }
            } catch (e) {
                console.error("Erro ao renderizar linhas da tabela de progresso:", e);
            }
        }

        function handleProgressCellEdit(event) {
            const cell = event.target;
            const key = cell.dataset.key;
            const index = parseInt(cell.dataset.index);
            let value = parseFloat(cell.textContent); // Try to parse as float

            // Handle potential NaN if user types non-numeric characters
            if (isNaN(value)) {
                value = 0; // Default to 0 or handle as an error
                cell.textContent = 0; // Correct the display
            }

            if (key === 'skinfolds') {
                const skinfoldIndex = parseInt(cell.dataset.skinfoldIndex);
                window.projectData.progress.skinfolds.data[index][skinfoldIndex] = value;
            } else {
                window.projectData.progress[key][index] = value;
            }
        }

        function handleProgressCellBlur() {
            // This function is called when a cell loses focus
            // It triggers a save to Firestore
            window.saveProgressDataToFirestore();
        }

        function addProgressRow() {
            const pData = window.projectData.progress;
            const newDate = new Date().toLocaleDateString('pt-BR'); // Current date

            // Add new empty entries for numerical data, and 0 for skinfolds
            pData.dates.push(newDate);
            pData.weight.push(0);
            pData.fatPercentage.push(0);
            pData.fatMass.push(0);
            pData.leanMass.push(0);
            pData.waist.push(0);
            pData.abdomen.push(0);
            pData.skinfolds.data.push(new Array(pData.skinfolds.labels.length).fill(0));

            renderProgressTable();
            window.saveProgressDataToFirestore(); // Save after adding
        }

        function removeProgressRow() {
            const pData = window.projectData.progress;
            if (pData.dates.length > 1) { // Ensure at least one row remains
                pData.dates.pop();
                pData.weight.pop();
                pData.fatPercentage.pop();
                pData.fatMass.pop();
                pData.leanMass.pop();
                pData.waist.pop();
                pData.abdomen.pop();
                pData.skinfolds.data.pop();
                renderProgressTable();
                window.saveProgressDataToFirestore(); // Save after removing
            } else {
                console.warn("Cannot remove last progress row.");
            }
        }

        function initCharts() {
            console.log('Initializing Charts...'); // Log para depura√ß√£o
            // Destroy existing charts if they exist to prevent memory leaks and re-rendering issues
            if (window.weightFatChartInstance) window.weightFatChartInstance.destroy();
            if (window.bodyCompositionChartInstance) window.bodyCompositionChartInstance.destroy();
            if (window.circumferenceChartInstance) window.circumferenceChartInstance.destroy();
            if (window.skinfoldChartInstance) window.skinfoldChartInstance.destroy();

            const progressData = window.projectData.progress;

            try {
                // Chart 1: Weight & Fat %
                const ctx1 = document.getElementById('weightFatChart');
                if (ctx1) {
                    window.weightFatChartInstance = new Chart(ctx1.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: progressData.dates,
                            datasets: [
                                {
                                    label: 'Peso (kg)',
                                    data: progressData.weight,
                                    borderColor: '#0d9488', // teal-600
                                    backgroundColor: '#ccfbf1', // teal-100
                                    yAxisID: 'y',
                                    tension: 0.1
                                },
                                {
                                    label: '% de Gordura',
                                    data: progressData.fatPercentage,
                                    borderColor: '#f97316', // orange-500
                                    backgroundColor: '#ffedd5', // orange-100
                                    yAxisID: 'y1',
                                    tension: 0.1
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: { position: 'left', title: { display: true, text: 'Peso (kg)' } },
                                y1: { position: 'right', title: { display: true, text: '% Gordura' }, grid: { drawOnChartArea: false } }
                            }
                        }
                    });
                } else { console.warn("Canvas 'weightFatChart' n√£o encontrado para o gr√°fico."); }


                // Chart 2: Body Composition
                const ctx2 = document.getElementById('bodyCompositionChart');
                if (ctx2) {
                    window.bodyCompositionChartInstance = new Chart(ctx2.getContext('2d'), {
                        type: 'bar',
                        data: {
                             labels: progressData.dates,
                             datasets: [
                                {
                                    label: 'Massa Gordurosa (kg)',
                                    data: progressData.fatMass,
                                    backgroundColor: '#f97316', // orange-500
                                },
                                 {
                                    label: 'Massa Livre de Gordura (kg)',
                                    data: progressData.leanMass,
                                    backgroundColor: '#0d9488', // teal-600
                                }
                             ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: { x: { stacked: true }, y: { stacked: true, title: {display: true, text: 'Massa (kg)'} } }
                        }
                    });
                } else { console.warn("Canvas 'bodyCompositionChart' n√£o encontrado para o gr√°fico."); }

                // Chart 3: Circumferences
                const ctx3 = document.getElementById('circumferenceChart');
                if (ctx3) {
                    window.circumferenceChartInstance = new Chart(ctx3.getContext('2d'), {
                        type: 'line',
                        data: {
                            labels: progressData.dates,
                            datasets: [
                                {
                                    label: 'Cintura (cm)',
                                    data: progressData.waist,
                                    borderColor: '#3b82f6', // blue-500
                                    backgroundColor: '#dbeafe', // blue-100
                                    tension: 0.1
                                },
                                {
                                    label: 'Abd√¥men (cm)',
                                    data: progressData.abdomen,
                                    borderColor: '#ec4899', // pink-500
                                    backgroundColor: '#fce7f3', // pink-100
                                    tension: 0.1
                                }
                            ]
                        },
                        options: {
                             responsive: true,
                             maintainAspectRatio: false,
                             scales: { y: { title: { display: true, text: 'Circunfer√™ncia (cm)' } } }
                        }
                    });
                } else { console.warn("Canvas 'circumferenceChart' n√£o encontrado para o gr√°fico."); }


                 // Chart 4: Skinfolds
                const ctx4 = document.getElementById('skinfoldChart');
                if (ctx4) {
                    window.skinfoldChartInstance = new Chart(ctx4.getContext('2d'), {
                        type: 'radar',
                        data: {
                            labels: progressData.skinfolds.labels,
                            datasets: progressData.dates.map((date, index) => ({
                                label: date,
                                data: progressData.skinfolds.data[index],
                                borderColor: `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.8)`, // Random color for each dataset
                                backgroundColor: `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.2)`,
                            }))
                        },
                        options: {
                             responsive: true,
                             maintainAspectRatio: false,
                             elements: { line: { tension: 0.1 } },
                             scales: { r: { pointLabels: { font: { size: 10 } } } }
                        }
                    });
                } else { console.warn("Canvas 'skinfoldChart' n√£o encontrado para o gr√°fico."); }

            } catch (e) {
                console.error("Erro ao inicializar gr√°ficos:", e);
            }
        }

         function initCalendarView() {
            console.log('Initializing Calendar View...'); // Log para depura√ß√£o
            const container = document.getElementById('calendario');
            if (!container) {
                console.error("Container #calendario n√£o encontrado!");
                return;
            }
            try {
                let calendarHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold text-slate-900 mb-4 text-center">Calend√°rio de Julho 2025</h3>
                        <div class="grid grid-cols-7 gap-1 text-center font-semibold text-slate-600 mb-2">
                            <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
                        </div>
                        <div class="grid grid-cols-7 gap-1">
                `;
                const firstDayOfMonth = new Date(2025, 6, 1).getDay(); // July 1, 2025 is a Tuesday (2)
                // If the first day is not Sunday, add empty divs to align days correctly
                for (let i = 0; i < firstDayOfMonth; i++) {
                    calendarHTML += `<div class="border rounded-md bg-slate-50 min-h-[96px]"></div>`; // Changed h-24 to min-h-[96px]
                }

                window.projectData.calendar.forEach(dayData => {
                    const today = new Date();
                    const currentYear = today.getFullYear();
                    const currentMonth = today.getMonth(); // 0-indexed
                    const dayDate = new Date(currentYear, currentMonth, dayData.day);

                    let financeIndicator = '';
                    // Check for bill payments
                    const obligationsToday = window.projectData.finances.billPayments.filter(bill => bill.day === dayData.day);
                    if (obligationsToday.length > 0) {
                        financeIndicator += '<span class="text-red-500 text-xs font-bold">üí≤</span>';
                    }

                    // Check for salary and advance payment
                    const salaryDate = getNthBusinessDay(currentYear, currentMonth, window.projectData.finances.salaryDetails.salaryDay, true);
                    if (salaryDate && salaryDate.getDate() === dayData.day) {
                        financeIndicator += '<span class="text-green-500 text-xs font-bold">üí∞</span>';
                    }

                    const advancePaymentDate = getNextBusinessDay(new Date(currentYear, currentMonth, window.projectData.finances.salaryDetails.advanceDay));
                    if (advancePaymentDate && advancePaymentDate.getDate() === dayData.day) {
                        financeIndicator += '<span class="text-green-500 text-xs font-bold">üíµ</span>';
                    }

                     calendarHTML += `
                        <div data-day="${dayData.day}" class="calendar-day border rounded-md p-2 min-h-[96px] flex flex-col justify-start cursor-pointer hover:bg-teal-50 transition">
                            <span class="font-bold self-end">${dayData.day} ${financeIndicator}</span>
                            <span class="text-xs text-slate-500 mt-1">${dayData.activity}</span>
                        </div>
                    `;
                });
                calendarHTML += `</div></div>`;
                container.innerHTML = calendarHTML;
            } catch (e) {
                console.error("Erro ao inicializar a vista 'Calend√°rio':", e);
            }
        }

        function initFinancesView() {
            console.log('Initializing Finances View...');
            const fixedPaymentsBody = document.getElementById('fixed-payments-body');
            const creditCardInfoBody = document.getElementById('credit-card-info-body'); // New tbody
            const salaryAdvanceBody = document.getElementById('salary-advance-body');

            if (!fixedPaymentsBody || !creditCardInfoBody || !salaryAdvanceBody) {
                console.error("Financial tables not found!");
                return;
            }

            // Populate Fixed Payments Table (Vencimentos) - NOW SORTED BY DAY AND THEN NAME
            fixedPaymentsBody.innerHTML = window.projectData.finances.billPayments.map(bill => `
                <tr class="border-b border-gray-200">
                    <td class="px-4 py-2">${bill.name}</td>
                    <td class="px-4 py-2">${bill.day}</td>
                    <td class="px-4 py-2">
                        <span contenteditable="true" class="inline-block min-w-[80px] text-right" data-bill-name="${bill.name}" data-bill-day="${bill.day}">0.00</span>
                    </td>
                    <td class="px-4 py-2"></td>
                </tr>
            `).join('');

            // Add event listeners for editable bill value cells
            document.querySelectorAll('#fixed-payments-body [contenteditable="true"]').forEach(cell => {
                cell.addEventListener('input', (e) => {
                    let value = e.target.textContent.replace(',', '.'); // Replace comma with dot for float parsing
                    if (isNaN(parseFloat(value))) {
                        e.target.textContent = '0.00'; // Reset if invalid
                    } else {
                        e.target.textContent = parseFloat(value).toFixed(2); // Format to 2 decimal places
                    }
                });
                cell.addEventListener('blur', (e) => {
                    // Optional: Save to local storage or Firestore if persistence is desired for these values
                    console.log(`Bill ${e.target.dataset.billName} on day ${e.target.dataset.billDay} updated to R$ ${e.target.textContent}`);
                });
            });

            // Populate Credit Card Info Table - NOW SORTED BY MATURITY DAY
            creditCardInfoBody.innerHTML = window.projectData.finances.creditCardInfo.map(card => `
                <tr class="border-b border-gray-200">
                    <td class="px-4 py-2">${card.name}</td>
                    <td class="px-4 py-2">${card.maturityDay}</td>
                    <td class="px-4 py-2">${card.closingDay}</td>
                </tr>
            `).join('');


            // Populate Salary and Advance Table for the next 12 months
            salaryAdvanceBody.innerHTML = '';
            const today = new Date();
            for (let i = 0; i < 12; i++) {
                const year = today.getFullYear();
                const month = (today.getMonth() + i) % 12; // 0-indexed month
                const displayYear = year + Math.floor((today.getMonth() + i) / 12); // Adjust year for next year's months

                const monthNames = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
                const monthName = monthNames[month];

                const salaryDate = getNthBusinessDay(displayYear, month, window.projectData.finances.salaryDetails.salaryDay, true);
                const advancePaymentDate = getNextBusinessDay(new Date(displayYear, month, window.projectData.finances.salaryDetails.advanceDay));

                const salaryDayFormatted = salaryDate ? salaryDate.getDate() : 'N/A';
                const advanceDayFormatted = advancePaymentDate ? advancePaymentDate.getDate() : 'N/A';

                const row = `
                    <tr class="border-b border-gray-200">
                        <td class="px-4 py-2">${monthName}/${displayYear}</td>
                        <td class="px-4 py-2 text-green-700 font-semibold">Dia ${salaryDayFormatted}</td>
                        <td class="px-4 py-2 text-green-700 font-semibold">Dia ${advanceDayFormatted}</td>
                    </tr>
                `;
                salaryAdvanceBody.innerHTML += row;
            }
        }

    </script>
</body>
</html>